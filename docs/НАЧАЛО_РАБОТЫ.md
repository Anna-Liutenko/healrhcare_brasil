# üöÄ –° –ß–ï–ì–û –ù–ê–ß–ê–¢–¨: –≠—Ç–∞–ø 5 - Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∞—Ç–∞:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** 42% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏  
**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:** Visual Editor, Backend API (auth, pages CRUD), Database

---

## üìã –ì–õ–ê–í–ù–´–ô –î–û–ö–£–ú–ï–ù–¢

### ‚úÖ –†–∞–±–æ—Ç–∞–π –ø–æ –û–î–ù–û–ú–£ –ø–ª–∞–Ω—É:

**`CMS_DEVELOPMENT_PLAN.md`** - —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –ø–ª–∞–Ω –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

**–ê—Ä—Ö–∏–≤–Ω—ã–µ –ø–ª–∞–Ω—ã** (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏):
- `docs/archive/–ü–õ–ê–ù_–í–Å–†–°–¢–ö–ê_–ò_INLINE.md` - –ø–µ—Ä–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫
- `docs/archive/–ü–õ–ê–ù_INLINE_–ò_–£–ü–†–ê–í–õ–ï–ù–ò–ï.md` - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è

---

## üéØ –≠–¢–ê–ü 5: Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (10-12 –¥–Ω–µ–π)

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ Clean Architecture:

```
–°–õ–û–ô 1: Entities (Domain)          ‚Üí 1 –¥–µ–Ω—å
–°–õ–û–ô 2: Use Cases (Application)    ‚Üí 2 –¥–Ω—è
–°–õ–û–ô 3: API (Infrastructure)       ‚Üí 2 –¥–Ω—è
–°–õ–û–ô 4: UI (Frameworks)            ‚Üí 5-7 –¥–Ω–µ–π
```

---

## üìÖ –î–ï–ù–¨ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Entities + –ë–î

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ–º —Å–µ–≥–æ–¥–Ω—è:

#### 1. –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (MySQL)

**–§–∞–π–ª:** `database/migrations/010_add_inline_editing_fields.sql`

```sql
-- –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
ALTER TABLE pages 
  ADD COLUMN visibility ENUM('public', 'unlisted', 'private') 
    DEFAULT 'public' 
    AFTER status,
  ADD COLUMN archived_at DATETIME NULL 
    AFTER published_at,
  ADD COLUMN last_edited_by CHAR(36) NULL 
    AFTER created_by;

-- –û–±–Ω–æ–≤–∏—Ç—å enum status (–¥–æ–±–∞–≤–∏—Ç—å 'scheduled')
ALTER TABLE pages 
  MODIFY COLUMN status ENUM('draft', 'published', 'archived', 'scheduled') 
    DEFAULT 'draft';

-- –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤
ALTER TABLE blocks 
  ADD COLUMN is_editable BOOLEAN DEFAULT TRUE,
  ADD COLUMN editable_fields JSON NULL;

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_pages_visibility ON pages(visibility);
CREATE INDEX idx_pages_archived_at ON pages(archived_at);
CREATE INDEX idx_pages_last_edited_by ON pages(last_edited_by);
```

**–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**

```powershell
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
mysql -u root -p healthcare_cms < database/migrations/010_add_inline_editing_fields.sql
```

#### 2. –û–±–Ω–æ–≤–∏—Ç—å PHP Entity: Page

**–§–∞–π–ª:** `backend/src/Domain/Page.php`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è:

```php
class Page
{
    private string $id;
    private string $title;
    private string $slug;
    private string $status;          // draft | published | archived | scheduled
    private string $visibility;      // ‚≠ê NEW: public | unlisted | private
    private string $type;
    private array $seo;
    private array $tracking;
    private array $blocks;
    private DateTime $createdAt;
    private DateTime $updatedAt;
    private ?DateTime $publishedAt;
    private ?DateTime $archivedAt;   // ‚≠ê NEW
    private string $createdBy;
    private ?string $lastEditedBy;   // ‚≠ê NEW

    // –ì–µ—Ç—Ç–µ—Ä—ã –∏ —Å–µ—Ç—Ç–µ—Ä—ã...
}
```

**–û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:**

```php
// Domain/Validators/PageValidator.php

public function validateStatus(string $status): void
{
    $allowedStatuses = ['draft', 'published', 'archived', 'scheduled'];
    if (!in_array($status, $allowedStatuses)) {
        throw new ValidationException("Invalid status. Allowed: " . implode(', ', $allowedStatuses));
    }
}

public function validateVisibility(string $visibility): void
{
    $allowedVisibilities = ['public', 'unlisted', 'private'];
    if (!in_array($visibility, $allowedVisibilities)) {
        throw new ValidationException("Invalid visibility. Allowed: " . implode(', ', $allowedVisibilities));
    }
}
```

#### 3. –û–±–Ω–æ–≤–∏—Ç—å PHP Entity: Block

**–§–∞–π–ª:** `backend/src/Domain/Block.php`

```php
class Block
{
    private string $id;
    private string $pageId;
    private string $type;
    private int $position;
    private ?string $customName;
    private array $data;
    private bool $isEditable;         // ‚≠ê NEW
    private array $editableFields;    // ‚≠ê NEW

    // –ü—Ä–∏–º–µ—Ä editableFields –¥–ª—è –±–ª–æ–∫–∞ main-screen:
    // ['data.title', 'data.text', 'data.backgroundImage', 'data.buttonText', 'data.buttonLink']
}
```

#### 4. –û–±–Ω–æ–≤–∏—Ç—å Repository

**–§–∞–π–ª:** `backend/src/Infrastructure/MySQLPageRepository.php`

–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã `save()` –∏ `findById()` —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∏ —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–ï–ù–¨ 1:

- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `010_add_inline_editing_fields.sql`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—è –¥–æ–±–∞–≤–∏–ª–∏—Å—å: `DESCRIBE pages;` –∏ `DESCRIBE blocks;`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `backend/src/Domain/Page.php` (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `backend/src/Domain/Block.php` (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã (PageValidator, BlockValidator)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MySQLPageRepository.php` (save, findById)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MySQLBlockRepository.php` (save, findById)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ API —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏

---

## üìö –°–ü–†–ê–í–ö–ê

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
backend/
  src/
    Domain/              ‚Üê –°–õ–û–ô 1: Entities, Validators
    Application/UseCase/ ‚Üê –°–õ–û–ô 2: Business logic
    Infrastructure/      ‚Üê –°–õ–û–ô 3: Repositories, Database
    Presentation/        ‚Üê –°–õ–û–ô 3: Controllers, API

database/
  migrations/          ‚Üê SQL –º–∏–≥—Ä–∞—Ü–∏–∏

frontend/
  editor.js            ‚Üê –°–õ–û–ô 4: UI logic
  api-client.js        ‚Üê –°–õ–û–ô 3: API communication
  utils/
    mappers.js         ‚Üê –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    validators.js      ‚Üê –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```powershell
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
mysql -u root -p healthcare_cms

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
DESCRIBE pages;
DESCRIBE blocks;

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
SELECT id, title, status, visibility, archived_at FROM pages ORDER BY created_at DESC LIMIT 5;

# –ó–∞–ø—É—Å—Ç–∏—Ç—å PHP —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cd c:\xampp\htdocs\healthcare-cms-backend\public
php -S localhost:8000

# –û—Ç–∫—Ä—ã—Ç—å Visual Editor
Start-Process "http://localhost/visual-editor-standalone/"
```

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –î–ù–ò:

**–î–µ–Ω—å 2-3:** Use Cases (ArchivePage, RestorePage, ChangePageVisibility, GetPreviewUrl, UpdateBlockField)  
**–î–µ–Ω—å 4-5:** API Endpoints (PUT /archive, /restore, /visibility, GET /preview-url, PATCH /blocks/:id/field)  
**–î–µ–Ω—å 6-9:** UI Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (contenteditable, debounce autosave, image editing)  
**–î–µ–Ω—å 10-11:** UI –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (toolbar, breadcrumbs, preview modal, page actions)  
**–î–µ–Ω—å 12:** Preview —Å—Ç—Ä–∞–Ω–∏—Ü–∞ + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìû –ì–î–ï –ò–°–ö–ê–¢–¨ –ü–û–ú–û–©–¨:

- **CMS_DEVELOPMENT_PLAN.md** - –≥–ª–∞–≤–Ω—ã–π –ø–ª–∞–Ω —Å –ø–æ–ª–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- **API_CONTRACT.md** - –≤—Å–µ API endpoints —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- **PROJECT_STATUS.md** - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (42% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)
- **DEBUG_HISTORY.md** - –∏—Å—Ç–æ—Ä–∏—è –æ—Ç–ª–∞–¥–∫–∏ –∏ —É—Ä–æ–∫–∏

---

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å? –û—Ç–∫—Ä–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –∑–∞–ø—É—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î!** üöÄ
