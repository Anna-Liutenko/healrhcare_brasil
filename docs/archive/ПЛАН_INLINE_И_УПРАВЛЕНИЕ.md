# üèóÔ∏è –û–ë–ù–û–í–õ–Å–ù–ù–´–ô –ü–õ–ê–ù: Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

**–î–∞—Ç–∞:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Clean Architecture (4 —Å–ª–æ—è)  
**–î–æ–±–∞–≤–ª–µ–Ω–æ:** Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, Preview, –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

---

## üìê –ù–û–í–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1. Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–ª–∏–∫ –Ω–∞ —Ç–µ–∫—Å—Ç ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä—è–º–æ –≤ —Å—Ä–µ–¥–Ω–µ–π –ø–∞–Ω–µ–ª–∏
- –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (debounce 3 —Å–µ–∫)
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### 2. –ù–∞–≤–∏–≥–∞—Ü–∏—è CMS
- –ö–Ω–æ–ø–∫–∞ "‚Üê –ö —Å–ø–∏—Å–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü" –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ –≤—Å–µ–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- Breadcrumbs (–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã > –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ > "–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã")

### 3. Preview (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä)
- –ö–Ω–æ–ø–∫–∞ "üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–∫–∞–∫ –Ω–∞ —Å–∞–π—Ç–µ)
- –ë–µ–∑ inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
- –ö–Ω–æ–ø–∫–∞ "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é"

### 4. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- **–°–æ–∑–¥–∞—Ç—å** - —É–∂–µ –µ—Å—Ç—å ‚úÖ
- **–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å** - —É–∂–µ –µ—Å—Ç—å ‚úÖ
- **–£–¥–∞–ª–∏—Ç—å** - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
- **–°–∫—Ä—ã—Ç—å/–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å** - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ —Å—Å—ã–ª–∫–µ** (unlisted) - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

---

## üèõÔ∏è CLEAN ARCHITECTURE: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ—è–º

### –°–õ–û–ô 1: ENTITIES (Domain Layer)

**–ß—Ç–æ –∑–¥–µ—Å—å:** –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –ó–ê–í–ò–°–Ø–¢ –æ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

#### 1.1. –û–±–Ω–æ–≤–∏—Ç—å Entity: Page

**–î–û–ë–ê–í–ò–¢–¨ –Ω–æ–≤–æ–µ –ø–æ–ª–µ –∏ —Å—Ç–∞—Ç—É—Å:**

```javascript
Page {
  id: string                    
  title: string                 
  slug: string                  
  status: PageStatus            // ‚Üê –û–ë–ù–û–í–ò–¢–¨ ENUM!
  visibility: PageVisibility    // ‚Üê –ù–û–í–û–ï –ü–û–õ–ï!
  type: PageType                
  seo: { ... }
  tracking: { ... }
  blocks: Block[]               
  createdAt: Date
  updatedAt: Date
  publishedAt: Date | null      
  archivedAt: Date | null       // ‚Üê –ù–û–í–û–ï –ü–û–õ–ï!
  createdBy: string             
  lastEditedBy: string | null   // ‚Üê –ù–û–í–û–ï –ü–û–õ–ï!
}

// ‚Üê –û–ë–ù–û–í–õ–Å–ù–ù–´–ô ENUM
enum PageStatus {
  DRAFT = 'draft',              // –ß–µ—Ä–Ω–æ–≤–∏–∫
  PUBLISHED = 'published',      // –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
  ARCHIVED = 'archived',        // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ (—Å–∫—Ä—ã—Ç–æ)
  SCHEDULED = 'scheduled'       // ‚Üê –ù–û–í–û–ï: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
}

// ‚Üê –ù–û–í–´–ô ENUM
enum PageVisibility {
  PUBLIC = 'public',            // –í–∏–¥–Ω–æ –≤—Å–µ–º, –≤ –º–µ–Ω—é, –≤ –ø–æ–∏—Å–∫–µ
  UNLISTED = 'unlisted',        // –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ
  PRIVATE = 'private'           // –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
}
```

**–û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:**

```
status:
  - required: true
  - enum: ['draft', 'published', 'archived', 'scheduled']
  - default: 'draft'

visibility:
  - required: true
  - enum: ['public', 'unlisted', 'private']
  - default: 'public'

archivedAt:
  - optional: true
  - type: Date | null
  - auto_set: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ archivePage()

lastEditedBy:
  - optional: true
  - type: UUID | null
  - auto_set: –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º updatePage()
```

#### 1.2. –û–±–Ω–æ–≤–∏—Ç—å Entity: Block

**–î–û–ë–ê–í–ò–¢–¨ –ø–æ–ª—è –¥–ª—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```javascript
Block {
  id: string                    
  pageId: string                
  type: BlockType               
  position: number              
  customName: string | null     
  data: object                  
  isEditable: boolean           // ‚Üê –ù–û–í–û–ï: –º–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å inline
  editableFields: string[]      // ‚Üê –ù–û–í–û–ï: –∫–∞–∫–∏–µ –ø–æ–ª—è –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                // –Ω–∞–ø—Ä–∏–º–µ—Ä: ['data.title', 'data.text', 'data.image']
}
```

**–ü—Ä–∏–º–µ—Ä:**

```javascript
{
  id: 'block-123',
  type: 'main-screen',
  isEditable: true,
  editableFields: [
    'data.title',           // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    'data.text',            // –û–ø–∏—Å–∞–Ω–∏–µ
    'data.backgroundImage', // –§–æ–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
    'data.buttonText',      // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
    'data.buttonLink'       // –°—Å—ã–ª–∫–∞ –∫–Ω–æ–ø–∫–∏
  ],
  data: {
    title: '–ú–µ–¥–∏—Ü–∏–Ω–∞ –≤ –ë—Ä–∞–∑–∏–ª–∏–∏',
    text: '–í–∞—à –≥–∏–¥...',
    backgroundImage: 'https://...',
    buttonText: '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è',
    buttonLink: '#'
  }
}
```

---

### –°–õ–û–ô 2: USE CASES (Application Layer)

**–ß—Ç–æ –∑–¥–µ—Å—å:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (orchestration)

#### 2.1. –ù–æ–≤—ã–µ Use Cases –¥–ª—è Pages

**–î–û–ë–ê–í–ò–¢–¨:**

```javascript
// –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–°–∫—Ä—ã—Ç—å)
class ArchivePage {
  constructor(pageRepository) {
    this.pageRepository = pageRepository;
  }

  async execute(pageId, archivedBy) {
    // 1. –ù–∞–π—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const page = await this.pageRepository.findById(pageId);
    if (!page) throw new NotFoundException('Page not found');

    // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ (–º–æ–∂–Ω–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ –µ—Å–ª–∏ admin)
    // (—ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ Presentation Layer —á–µ—Ä–µ–∑ middleware)

    // 3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    page.status = 'archived';
    page.archivedAt = new Date();
    page.lastEditedBy = archivedBy;

    // 4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    await this.pageRepository.save(page);

    return { success: true, pageId: page.id };
  }
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∞—Ä—Ö–∏–≤–∞
class RestorePage {
  constructor(pageRepository) {
    this.pageRepository = pageRepository;
  }

  async execute(pageId, restoredBy) {
    const page = await this.pageRepository.findById(pageId);
    if (!page) throw new NotFoundException('Page not found');

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫
    page.status = 'draft';
    page.archivedAt = null;
    page.lastEditedBy = restoredBy;

    await this.pageRepository.save(page);

    return { success: true, pageId: page.id };
  }
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
class ChangePageVisibility {
  constructor(pageRepository) {
    this.pageRepository = pageRepository;
  }

  async execute(pageId, visibility, changedBy) {
    // visibility: 'public' | 'unlisted' | 'private'
    
    const page = await this.pageRepository.findById(pageId);
    if (!page) throw new NotFoundException('Page not found');

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!['public', 'unlisted', 'private'].includes(visibility)) {
      throw new ValidationException('Invalid visibility value');
    }

    page.visibility = visibility;
    page.lastEditedBy = changedBy;

    await this.pageRepository.save(page);

    return { success: true, pageId: page.id, visibility };
  }
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Soft Delete)
class DeletePage {
  constructor(pageRepository, blockRepository) {
    this.pageRepository = pageRepository;
    this.blockRepository = blockRepository;
  }

  async execute(pageId, deletedBy) {
    const page = await this.pageRepository.findById(pageId);
    if (!page) throw new NotFoundException('Page not found');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ admin)

    // Soft delete: –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ archived + –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ deleted
    page.status = 'archived';
    page.archivedAt = new Date();
    page.deletedBy = deletedBy;
    page.isDeleted = true;

    await this.pageRepository.save(page);

    // –ò–õ–ò Hard delete (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏)
    // await this.blockRepository.deleteByPageId(pageId); // CASCADE –≤ –ë–î
    // await this.pageRepository.delete(pageId);

    return { success: true, pageId };
  }
}

// –ü–æ–ª—É—á–∏—Ç—å Preview URL
class GetPreviewUrl {
  constructor(pageRepository) {
    this.pageRepository = pageRepository;
  }

  async execute(pageId) {
    const page = await this.pageRepository.findById(pageId);
    if (!page) throw new NotFoundException('Page not found');

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è preview —Ç–æ–∫–µ–Ω–∞ (–¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º)
    const previewToken = this.generatePreviewToken(page.id);

    const previewUrl = `/preview/${page.slug}?token=${previewToken}`;

    return { previewUrl, token: previewToken };
  }

  generatePreviewToken(pageId) {
    // JWT —Ç–æ–∫–µ–Ω —Å –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è (1 —á–∞—Å)
    return jwt.sign(
      { pageId, type: 'preview' },
      process.env.JWT_SECRET,
      { expiresIn: '1h' }
    );
  }
}

// –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –±–ª–æ–∫–∞ (–¥–ª—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
class UpdateBlockField {
  constructor(blockRepository) {
    this.blockRepository = blockRepository;
  }

  async execute(blockId, fieldPath, newValue, editedBy) {
    // fieldPath: 'data.title' | 'data.image' | 'customName'
    
    const block = await this.blockRepository.findById(blockId);
    if (!block) throw new NotFoundException('Block not found');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ
    if (!block.editableFields.includes(fieldPath)) {
      throw new ValidationException(`Field ${fieldPath} is not editable`);
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π)
    this.setNestedValue(block, fieldPath, newValue);

    // –û–±–Ω–æ–≤–∏—Ç—å timestamp
    block.updatedAt = new Date();

    await this.blockRepository.save(block);

    return { success: true, blockId, fieldPath, newValue };
  }

  setNestedValue(obj, path, value) {
    const keys = path.split('.');
    let current = obj;
    for (let i = 0; i < keys.length - 1; i++) {
      current = current[keys[i]];
    }
    current[keys[keys.length - 1]] = value;
  }
}
```

#### 2.2. –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ Use Cases

**UpdatePage - –¥–æ–±–∞–≤–∏—Ç—å lastEditedBy:**

```javascript
class UpdatePage {
  async execute(pageId, pageData, editedBy) {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

    page.lastEditedBy = editedBy; // ‚Üê –î–û–ë–ê–í–ò–¢–¨
    page.updatedAt = new Date();

    await this.pageRepository.save(page);
    
    // ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ blocks ...
  }
}
```

---

### –°–õ–û–ô 3: INTERFACE ADAPTERS (Infrastructure + Presentation)

**–ß—Ç–æ –∑–¥–µ—Å—å:** –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, API endpoints

#### 3.1. Backend: –ù–æ–≤—ã–µ API Endpoints

**–î–û–ë–ê–í–ò–¢–¨ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º:**

```php
// PageController.php

/**
 * –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (–°–∫—Ä—ã—Ç—å)
 * PUT /api/pages/:id/archive
 */
public function archive(string $pageId): void
{
    try {
        ApiLogger::logRequest();

        $currentUser = $this->getCurrentUser(); // –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞

        $pageRepository = new MySQLPageRepository();
        $useCase = new ArchivePage($pageRepository);

        $result = $useCase->execute($pageId, $currentUser->id);

        $this->jsonResponse(['success' => true, 'pageId' => $result['pageId']], 200);

    } catch (NotFoundException $e) {
        $this->jsonResponse(['error' => 'Page not found'], 404);
    } catch (\Exception $e) {
        $this->jsonResponse(['error' => $e->getMessage()], 500);
    }
}

/**
 * –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∞—Ä—Ö–∏–≤–∞
 * PUT /api/pages/:id/restore
 */
public function restore(string $pageId): void
{
    // ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ archive ...
}

/**
 * –ò–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å
 * PUT /api/pages/:id/visibility
 * Body: { "visibility": "public" | "unlisted" | "private" }
 */
public function changeVisibility(string $pageId): void
{
    try {
        $data = json_decode(file_get_contents('php://input'), true);
        $visibility = $data['visibility'] ?? null;

        if (!$visibility) {
            throw new ValidationException('Visibility is required');
        }

        $currentUser = $this->getCurrentUser();

        $pageRepository = new MySQLPageRepository();
        $useCase = new ChangePageVisibility($pageRepository);

        $result = $useCase->execute($pageId, $visibility, $currentUser->id);

        $this->jsonResponse($result, 200);

    } catch (ValidationException $e) {
        $this->jsonResponse(['error' => $e->getMessage()], 400);
    }
}

/**
 * –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
 * DELETE /api/pages/:id
 */
public function delete(string $pageId): void
{
    try {
        $currentUser = $this->getCurrentUser();

        $pageRepository = new MySQLPageRepository();
        $blockRepository = new MySQLBlockRepository();
        $useCase = new DeletePage($pageRepository, $blockRepository);

        $result = $useCase->execute($pageId, $currentUser->id);

        $this->jsonResponse($result, 200);

    } catch (NotFoundException $e) {
        $this->jsonResponse(['error' => 'Page not found'], 404);
    }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å preview URL
 * GET /api/pages/:id/preview-url
 */
public function getPreviewUrl(string $pageId): void
{
    try {
        $pageRepository = new MySQLPageRepository();
        $useCase = new GetPreviewUrl($pageRepository);

        $result = $useCase->execute($pageId);

        $this->jsonResponse($result, 200);

    } catch (NotFoundException $e) {
        $this->jsonResponse(['error' => 'Page not found'], 404);
    }
}
```

**BlockController.php (–ù–û–í–´–ô):**

```php
/**
 * –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –±–ª–æ–∫–∞ (–¥–ª—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
 * PATCH /api/blocks/:id/field
 * Body: { "fieldPath": "data.title", "value": "–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫" }
 */
public function updateField(string $blockId): void
{
    try {
        ApiLogger::logRequest();

        $data = json_decode(file_get_contents('php://input'), true);
        $fieldPath = $data['fieldPath'] ?? null;
        $value = $data['value'] ?? null;

        if (!$fieldPath) {
            throw new ValidationException('Field path is required');
        }

        $currentUser = $this->getCurrentUser();

        $blockRepository = new MySQLBlockRepository();
        $useCase = new UpdateBlockField($blockRepository);

        $result = $useCase->execute($blockId, $fieldPath, $value, $currentUser->id);

        $this->jsonResponse($result, 200);

    } catch (ValidationException $e) {
        $this->jsonResponse(['error' => $e->getMessage()], 400);
    } catch (NotFoundException $e) {
        $this->jsonResponse(['error' => 'Block not found'], 404);
    }
}
```

#### 3.2. Frontend: –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã API Client

**api-client.js - –î–û–ë–ê–í–ò–¢–¨:**

```javascript
class ApiClient {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã ...

  /**
   * –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
   */
  async archivePage(pageId) {
    return await this.request(`/api/pages/${pageId}/archive`, {
      method: 'PUT'
    });
  }

  /**
   * –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ –∞—Ä—Ö–∏–≤–∞
   */
  async restorePage(pageId) {
    return await this.request(`/api/pages/${pageId}/restore`, {
      method: 'PUT'
    });
  }

  /**
   * –ò–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   */
  async changePageVisibility(pageId, visibility) {
    return await this.request(`/api/pages/${pageId}/visibility`, {
      method: 'PUT',
      body: JSON.stringify({ visibility })
    });
  }

  /**
   * –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
   */
  async deletePage(pageId) {
    return await this.request(`/api/pages/${pageId}`, {
      method: 'DELETE'
    });
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å preview URL
   */
  async getPreviewUrl(pageId) {
    return await this.request(`/api/pages/${pageId}/preview-url`, {
      method: 'GET'
    });
  }

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –±–ª–æ–∫–∞ (inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
   */
  async updateBlockField(blockId, fieldPath, value) {
    return await this.request(`/api/blocks/${blockId}/field`, {
      method: 'PATCH',
      body: JSON.stringify({ fieldPath, value })
    });
  }
}
```

---

### –°–õ–û–ô 4: FRAMEWORKS & DRIVERS (UI Layer)

**–ß—Ç–æ –∑–¥–µ—Å—å:** Vue –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, HTML, CSS, user interactions

#### 4.1. Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (editor.js)

**–î–û–ë–ê–í–ò–¢–¨ –º–µ—Ç–æ–¥—ã:**

```javascript
// –í Vue app editor.js

data() {
  return {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ ...
    
    // –î–ª—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    editingBlockId: null,
    editingFieldPath: null,
    autoSaveTimer: null,
    isPreviewMode: false
  };
},

mounted() {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  this.setupInlineEditing();
},

methods: {
  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   */
  setupInlineEditing() {
    // –ù–∞–π—Ç–∏ –≤—Å–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    this.$nextTick(() => {
      const editableElements = document.querySelectorAll('[data-editable]');
      
      editableElements.forEach(el => {
        el.contentEditable = true;
        el.classList.add('inline-editable');
        
        // –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ
        el.addEventListener('focus', (e) => {
          el.classList.add('editing');
          
          this.editingBlockId = el.closest('[data-block-id]')?.dataset.blockId;
          this.editingFieldPath = el.dataset.editable;
        });
        
        // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        el.addEventListener('blur', (e) => {
          el.classList.remove('editing');
          
          this.editingBlockId = null;
          this.editingFieldPath = null;
        });
        
        // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ - –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        el.addEventListener('input', this.debounce((e) => {
          const blockId = el.closest('[data-block-id]')?.dataset.blockId;
          const fieldPath = el.dataset.editable;
          const newValue = el.textContent;
          
          this.updateBlockFieldInline(blockId, fieldPath, newValue);
        }, 3000)); // 3 —Å–µ–∫—É–Ω–¥—ã debounce
      });
      
      // Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫
      const editableImages = document.querySelectorAll('[data-image-editable]');
      editableImages.forEach(img => {
        this.wrapImageWithEditButton(img);
      });
    });
  },

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –±–ª–æ–∫–∞ (inline)
   */
  async updateBlockFieldInline(blockId, fieldPath, newValue) {
    try {
      // –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
      const block = this.blocks.find(b => b.id === blockId);
      if (!block) return;
      
      this.setNestedValue(block, fieldPath, newValue);
      
      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ backend
      await this.apiClient.updateBlockField(blockId, fieldPath, newValue);
      
      this.showNotification('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'success');
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
      this.showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
    }
  },

  /**
   * –û–±–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –∫–Ω–æ–ø–∫–æ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   */
  wrapImageWithEditButton(img) {
    const wrapper = document.createElement('div');
    wrapper.className = 'image-edit-wrapper';
    img.parentNode.insertBefore(wrapper, img);
    wrapper.appendChild(img);
    
    const editBtn = document.createElement('button');
    editBtn.className = 'image-edit-btn';
    editBtn.innerHTML = 'üì∑ –ò–∑–º–µ–Ω–∏—Ç—å';
    editBtn.onclick = (e) => {
      e.preventDefault();
      this.openImagePicker(img);
    };
    wrapper.appendChild(editBtn);
  },

  /**
   * –û—Ç–∫—Ä—ã—Ç—å –≤—ã–±–æ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏
   */
  async openImagePicker(imgElement) {
    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    // (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –≠—Ç–∞–ø–µ 4 - –ú–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
    
    // –ü–æ–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - file input
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ upload.php –∏–ª–∏ API)
      const formData = new FormData();
      formData.append('image', file);
      
      try {
        const response = await fetch('/admin/upload.php', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          // –ó–∞–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É
          imgElement.src = data.url;
          
          // –û–±–Ω–æ–≤–∏—Ç—å –≤ –±–ª–æ–∫–µ
          const blockId = imgElement.closest('[data-block-id]')?.dataset.blockId;
          const fieldPath = imgElement.dataset.imageEditable;
          
          await this.updateBlockFieldInline(blockId, fieldPath, data.url);
          
          this.showNotification('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
        }
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        this.showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
      }
    };
    
    input.click();
  },

  /**
   * Debounce helper
   */
  debounce(func, wait) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  },

  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–º—É –ø—É—Ç–∏
   */
  setNestedValue(obj, path, value) {
    const keys = path.split('.');
    let current = obj;
    for (let i = 0; i < keys.length - 1; i++) {
      current = current[keys[i]];
    }
    current[keys[keys.length - 1]] = value;
  }
}
```

#### 4.2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (editor.js)

**–î–û–ë–ê–í–ò–¢–¨ –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫:**

```javascript
methods: {
  /**
   * –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (–°–∫—Ä—ã—Ç—å)
   */
  async archivePage() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–∫—Ä—ã—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) return;
    
    try {
      await this.apiClient.archivePage(this.currentPageId);
      this.pageData.status = 'archived';
      this.showNotification('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫—Ä—ã—Ç–∞', 'success');
      
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü
      setTimeout(() => {
        window.location.href = '/admin/pages.html';
      }, 1500);
      
    } catch (error) {
      this.showNotification('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
    }
  },

  /**
   * –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
   */
  async deletePage() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
    
    try {
      await this.apiClient.deletePage(this.currentPageId);
      this.showNotification('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
      
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü
      setTimeout(() => {
        window.location.href = '/admin/pages.html';
      }, 1500);
      
    } catch (error) {
      this.showNotification('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
    }
  },

  /**
   * –ò–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   */
  async changeVisibility(visibility) {
    try {
      await this.apiClient.changePageVisibility(this.currentPageId, visibility);
      this.pageData.visibility = visibility;
      
      const labels = {
        'public': '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–∏–¥–Ω–∞ –≤—Å–µ–º',
        'unlisted': '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ —Å—Å—ã–ª–∫–µ',
        'private': '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º'
      };
      
      this.showNotification(`‚úÖ ${labels[visibility]}`, 'success');
      
    } catch (error) {
      this.showNotification('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
    }
  },

  /**
   * –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
   */
  async openPreview() {
    try {
      // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
      await this.savePage();
      
      // –ü–æ–ª—É—á–∏—Ç—å preview URL
      const result = await this.apiClient.getPreviewUrl(this.currentPageId);
      
      // –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
      window.open(result.previewUrl, '_blank');
      
    } catch (error) {
      this.showNotification('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
    }
  },

  /**
   * –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü
   */
  goToPagesList() {
    window.location.href = '/admin/pages.html';
  }
}
```

#### 4.3. HTML: –û–±–Ω–æ–≤–∏—Ç—å toolbar

**index.html - –æ–±–Ω–æ–≤–∏—Ç—å toolbar:**

```html
<!-- Toolbar -->
<div class="toolbar">
  <div class="toolbar-left">
    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É" -->
    <button @click="goToPagesList" class="btn-secondary">
      ‚Üê –ö —Å–ø–∏—Å–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü
    </button>
    
    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
      <span class="breadcrumb-item">–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</span>
      <span class="breadcrumb-separator">‚Ä∫</span>
      <span class="breadcrumb-item">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
      <span class="breadcrumb-separator">‚Ä∫</span>
      <span class="breadcrumb-item active">{{ pageData.title || '–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞' }}</span>
    </div>
  </div>
  
  <div class="toolbar-center">
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
    <span v-if="isSaving" class="saving-indicator">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
    <span v-else-if="lastSavedAt" class="saved-indicator">‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {{ lastSavedAt }}</span>
  </div>
  
  <div class="toolbar-right">
    <!-- –í–∏–¥–∏–º–æ—Å—Ç—å -->
    <div class="visibility-dropdown">
      <button class="btn-dropdown">
        {{ visibilityLabel }} ‚ñº
      </button>
      <div class="dropdown-menu">
        <button @click="changeVisibility('public')">
          üåç –ü—É–±–ª–∏—á–Ω–∞—è
        </button>
        <button @click="changeVisibility('unlisted')">
          üîó –ü–æ —Å—Å—ã–ª–∫–µ
        </button>
        <button @click="changeVisibility('private')">
          üîí –ü—Ä–∏–≤–∞—Ç–Ω–∞—è
        </button>
      </div>
    </div>
    
    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
    <button @click="openPreview" class="btn-secondary">
      üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    </button>
    
    <!-- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å -->
    <button @click="savePage" class="btn-primary" :disabled="isSaving">
      üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    </button>
    
    <!-- –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å -->
    <button 
      v-if="pageData.status !== 'published'" 
      @click="publishPage" 
      class="btn-success"
    >
      üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
    </button>
    
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="more-actions-dropdown">
      <button class="btn-secondary">‚ãÆ</button>
      <div class="dropdown-menu">
        <button @click="archivePage">
          üì¶ –°–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        </button>
        <button @click="deletePage" class="text-danger">
          üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        </button>
      </div>
    </div>
  </div>
</div>
```

#### 4.4. CSS —Å—Ç–∏–ª–∏ –¥–ª—è inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**styles.css - –î–û–ë–ê–í–ò–¢–¨:**

```css
/* ============================================
   INLINE-–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï
   ============================================ */

/* –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
[data-editable] {
  position: relative;
  transition: all 0.2s ease;
  border-radius: 4px;
}

[data-editable]:hover {
  outline: 2px dashed rgba(0, 141, 141, 0.3);
  outline-offset: 4px;
  cursor: text;
  background-color: rgba(0, 141, 141, 0.02);
}

[data-editable].editing {
  outline: 2px solid rgba(0, 141, 141, 0.8);
  background-color: rgba(0, 141, 141, 0.05);
  outline-offset: 4px;
}

[data-editable]:focus {
  outline: 2px solid var(--color-action);
  background-color: rgba(0, 141, 141, 0.1);
  outline-offset: 4px;
}

/* –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
.image-edit-wrapper {
  position: relative;
  display: inline-block;
}

.image-edit-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 8px 16px;
  background: rgba(0, 141, 141, 0.9);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.3s ease;
  font-size: 14px;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.image-edit-wrapper:hover .image-edit-btn {
  opacity: 1;
}

.image-edit-btn:hover {
  background: rgba(0, 141, 141, 1);
  transform: scale(1.05);
}

/* Breadcrumbs */
.breadcrumbs {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 20px;
  font-size: 14px;
  color: var(--text-secondary);
}

.breadcrumb-item {
  color: var(--text-secondary);
}

.breadcrumb-item.active {
  color: var(--text-dark);
  font-weight: 600;
}

.breadcrumb-separator {
  color: var(--text-secondary);
  opacity: 0.5;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
.saving-indicator,
.saved-indicator {
  font-size: 14px;
  padding: 4px 12px;
  border-radius: 4px;
}

.saving-indicator {
  color: var(--color-action);
  background: rgba(0, 141, 141, 0.1);
}

.saved-indicator {
  color: #28a745;
  background: rgba(40, 167, 69, 0.1);
}

/* Dropdown –º–µ–Ω—é */
.visibility-dropdown,
.more-actions-dropdown {
  position: relative;
  display: inline-block;
}

.btn-dropdown {
  padding: 10px 16px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s ease;
}

.btn-dropdown:hover {
  background: #f8f9fa;
  border-color: var(--color-action);
}

.dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 8px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  z-index: 1000;
}

.visibility-dropdown:hover .dropdown-menu,
.more-actions-dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown-menu button {
  display: block;
  width: 100%;
  padding: 12px 16px;
  text-align: left;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s ease;
}

.dropdown-menu button:hover {
  background: rgba(0, 141, 141, 0.05);
}

.dropdown-menu button.text-danger {
  color: #dc3545;
}

.dropdown-menu button.text-danger:hover {
  background: rgba(220, 53, 69, 0.05);
}
```

---

## üìä –û–ë–ù–û–í–õ–Å–ù–ù–´–ô –ü–õ–ê–ù –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –≠—Ç–∞–ø 5: Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (–ù–û–í–´–ô, –î–ï–¢–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–ô)

#### 5.1. –°–õ–û–ô 1: –û–±–Ω–æ–≤–∏—Ç—å Entities (1 –¥–µ–Ω—å)

**Backend (PHP):**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Entity Page:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `visibility` (enum: public/unlisted/private)
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `archivedAt` (Date | null)
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `lastEditedBy` (UUID | null)
  - –û–±–Ω–æ–≤–∏—Ç—å enum `PageStatus` (–¥–æ–±–∞–≤–∏—Ç—å 'scheduled')
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Entity Block:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `isEditable` (boolean)
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `editableFields` (array)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ Domain Layer
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ë–î –º–∏–≥—Ä–∞—Ü–∏–∏ (ALTER TABLE)

**Frontend (JavaScript):**
- [ ] –°–æ–∑–¥–∞—Ç—å `frontend/utils/mappers.js`:
  - `toPlainObject()`
  - `blockToAPI()` / `blockFromAPI()`
  - `transliterate()`
  - `generateSlug()`
- [ ] –°–æ–∑–¥–∞—Ç—å `frontend/utils/validators.js`:
  - `validateSlug()`
  - `validateVisibility()`

#### 5.2. –°–õ–û–ô 2: –ù–æ–≤—ã–µ Use Cases (2 –¥–Ω—è)

**Backend (PHP):**
- [ ] –°–æ–∑–¥–∞—Ç—å `ArchivePage` Use Case
- [ ] –°–æ–∑–¥–∞—Ç—å `RestorePage` Use Case
- [ ] –°–æ–∑–¥–∞—Ç—å `ChangePageVisibility` Use Case
- [ ] –°–æ–∑–¥–∞—Ç—å `DeletePage` Use Case (Soft Delete)
- [ ] –°–æ–∑–¥–∞—Ç—å `GetPreviewUrl` Use Case
- [ ] –°–æ–∑–¥–∞—Ç—å `UpdateBlockField` Use Case
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `UpdatePage` (–¥–æ–±–∞–≤–∏—Ç—å lastEditedBy)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö Use Cases

#### 5.3. –°–õ–û–ô 3: API Endpoints + Repositories (2 –¥–Ω—è)

**Backend (PHP):**
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `PUT /api/pages/:id/archive`
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `PUT /api/pages/:id/restore`
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `PUT /api/pages/:id/visibility`
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `DELETE /api/pages/:id`
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `GET /api/pages/:id/preview-url`
- [ ] –°–æ–∑–¥–∞—Ç—å `BlockController.php`
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `PATCH /api/blocks/:id/field`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MySQLPageRepository` (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MySQLBlockRepository` (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (ApiLogger)

**Frontend (JavaScript):**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `api-client.js`:
  - `archivePage()`
  - `restorePage()`
  - `changePageVisibility()`
  - `deletePage()`
  - `getPreviewUrl()`
  - `updateBlockField()`

#### 5.4. –°–õ–û–ô 4: UI - Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3-4 –¥–Ω—è)

**Frontend (Vue.js):**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `setupInlineEditing()`:
  - –ù–∞–π—Ç–∏ –≤—Å–µ `[data-editable]` —ç–ª–µ–º–µ–Ω—Ç—ã
  - –î–æ–±–∞–≤–∏—Ç—å `contenteditable="true"`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ focus/blur
  - –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ hover
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `updateBlockFieldInline()`:
  - –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ backend (debounce 3 —Å–µ–∫)
  - –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `wrapImageWithEditButton()`:
  - –û–±–µ—Ä–Ω—É—Ç—å `<img>` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
  - –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üì∑ –ò–∑–º–µ–Ω–∏—Ç—å"
  - Hover overlay
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `openImagePicker()`:
  - –í—Ä–µ–º–µ–Ω–Ω–æ: file input
  - –ü–æ—Ç–æ–º: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å CSS —Å—Ç–∏–ª–∏:
  - –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  - Hover/Focus —ç—Ñ—Ñ–µ–∫—Ç—ã
  - –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏

#### 5.5. –°–õ–û–ô 4: UI - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (1-2 –¥–Ω—è)

**Frontend (HTML + Vue.js):**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å toolbar:
  - –ö–Ω–æ–ø–∫–∞ "‚Üê –ö —Å–ø–∏—Å–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü"
  - Breadcrumbs
  - Dropdown "–í–∏–¥–∏–º–æ—Å—Ç—å"
  - –ö–Ω–æ–ø–∫–∞ "üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä"
  - Dropdown "‚ãÆ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è"
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:
  - `archivePage()`
  - `deletePage()`
  - `changeVisibility()`
  - `openPreview()`
  - `goToPagesList()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
  - "üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."
  - "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ [–≤—Ä–µ–º—è]"
- [ ] –°—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å:
  - Breadcrumbs
  - Dropdown –º–µ–Ω—é
  - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

#### 5.6. Preview —Å—Ç—Ä–∞–Ω–∏—Ü—ã (1 –¥–µ–Ω—å)

**Backend (PHP):**
- [ ] –°–æ–∑–¥–∞—Ç—å `PreviewController.php`
- [ ] Endpoint `GET /preview/:slug?token=xxx`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ preview —Ç–æ–∫–µ–Ω–∞
- [ ] –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–¥–∞–∂–µ –µ—Å–ª–∏ draft)

**Frontend (HTML):**
- [ ] –°–æ–∑–¥–∞—Ç—å `preview.html`:
  - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–ª–æ–∫–æ–≤ (–±–µ–∑ inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
  - –ö–Ω–æ–ø–∫–∞ "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é"
  - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞"

---

## üéØ –ò–¢–û–ì–û: –≠—Ç–∞–ø 5

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 10-12 –¥–Ω–µ–π

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**
- –°–ª–æ–π 1 (Entities): 1 –¥–µ–Ω—å
- –°–ª–æ–π 2 (Use Cases): 2 –¥–Ω—è
- –°–ª–æ–π 3 (API): 2 –¥–Ω—è
- –°–ª–æ–π 4 (UI - Inline): 3-4 –¥–Ω—è
- –°–ª–æ–π 4 (UI - Management): 1-2 –¥–Ω—è
- Preview: 1 –¥–µ–Ω—å

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü  
‚úÖ Preview –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π  
‚úÖ –í–∏–¥–∏–º–æ—Å—Ç—å (public/unlisted/private)  
‚úÖ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ  

---

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –≠–¢–ê–ü–´ (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã)

- **–≠—Ç–∞–ø 4:** Frontend - –ê–¥–º–∏–Ω–∫–∞ (—Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü, –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –º–µ–Ω—é, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- **–≠—Ç–∞–ø 6:** Frontend - –ü—É–±–ª–∏—á–Ω—ã–π —Å–∞–π—Ç
- **–≠—Ç–∞–ø 7:** –î–µ–ø–ª–æ–π
- **–≠—Ç–∞–ø 8:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–î–∞—Ç–∞:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ù–∞—á–∞—Ç—å —Å –°–ª–æ—è 1 (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Entities)
