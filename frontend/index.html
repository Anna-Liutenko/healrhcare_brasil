<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü - Healthcare Brazil CMS</title>

    <link rel="stylesheet" href="styles/main.css" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            font-family: var(--font-heading);
        }

        [v-cloak] { display: none; }

        /* Header */
        .admin-header {
            background: var(--text-dark);
            color: var(--color-white);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-name {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }

        .btn-logout {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-header h2 {
            margin: 0;
            font-size: 2rem;
            color: var(--text-dark);
        }

        .btn-create {
            padding: 0.75rem 1.5rem;
            background: var(--color-action);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.4);
        }

        /* Search & Filters */
        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--color-action);
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.75rem 1.25rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            border-color: var(--color-action);
            color: var(--color-action);
        }

        .filter-btn.active {
            background: var(--color-action);
            border-color: var(--color-action);
            color: white;
        }

        /* Pages Table */
        .pages-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f9fafb;
            border-bottom: 2px solid #e5e7eb;
        }

        th {
            text-align: left;
            padding: 1rem 1.5rem;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        td {
            padding: 1rem 1.5rem;
            color: var(--text-dark);
        }

        .page-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-dark);
        }

        .page-slug {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: monospace;
        }

        .page-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #e0f2fe;
            color: #0369a1;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .page-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .page-status.draft {
            background: #fef3c7;
            color: #92400e;
        }

        .page-status.published {
            background: #dcfce7;
            color: #166534;
        }

        .page-status.archived {
            background: #f3f4f6;
            color: #6b7280;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .page-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Actions */
        .page-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem 0.75rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .action-btn.edit {
            color: var(--color-action);
        }

        .action-btn.edit:hover {
            background: rgba(0, 141, 141, 0.1);
        }

        .action-btn.delete {
            color: #dc2626;
        }

        .action-btn.delete:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            margin: 1rem 0 0.5rem;
            font-size: 1.25rem;
            color: var(--text-dark);
        }

        .empty-state p {
            margin: 0 0 1.5rem;
            font-size: 0.95rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top-color: var(--color-action);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Login Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-modal {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-modal h2 {
            margin: 0 0 1.5rem;
            font-size: 1.75rem;
            color: var(--text-dark);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-action);
        }

        .btn-login {
            width: 100%;
            padding: 0.875rem;
            background: var(--color-action);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.4);
        }

        .btn-login:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-error {
            padding: 0.75rem;
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border-left: 4px solid var(--color-action);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.error {
            border-left-color: #dc2626;
        }

        .notification.success {
            border-left-color: #16a34a;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== USER MANAGEMENT STYLES ===== */
        
        .btn-manage-users {
            padding: 0.5rem 1rem;
            background: var(--color-action);
            border: 1px solid var(--color-action);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .btn-manage-users:hover {
            background: rgba(0, 141, 141, 0.9);
            transform: translateY(-1px);
        }
        
        .user-management-modal {
            background: white;
            border-radius: 16px;
            width: 95%;
            max-width: 1100px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }
        
        .modal-header-bar h2 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-dark);
        }
        
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
            padding: 0.25rem 0.5rem;
        }
        
        .modal-close-btn:hover {
            color: var(--text-dark);
        }
        
        .modal-content-body {
            padding: 2rem;
        }
        
        /* User Form */
        
        .user-form-section {
            background: #f9fafb;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .user-form-section h3 {
            margin: 0 0 1.5rem 0;
            font-size: 1.25rem;
            color: var(--text-dark);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem;
            margin-bottom: 1.25rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-action);
        }
        
        .form-group input:disabled {
            background-color: #f0f0f0;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .form-hint {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        .form-group-checkbox {
            margin-bottom: 1.5rem;
        }
        
        .form-group-checkbox label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 500;
        }
        
        .form-group-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn-save-user {
            padding: 0.75rem 1.5rem;
            background: var(--color-action);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-save-user:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.4);
        }
        
        .btn-cancel-form {
            padding: 0.75rem 1.5rem;
            background: #f3f4f6;
            color: var(--text-dark);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-cancel-form:hover {
            background: #e5e7eb;
        }
        
        /* Create User Section */
        
        .create-user-section {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .btn-create-user {
            padding: 0.75rem 2rem;
            background: var(--color-action);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-create-user:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.4);
        }
        
        /* Users List */
        
        .users-list-section h3 {
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
            color: var(--text-dark);
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .users-table thead {
            background: #f9fafb;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .users-table th {
            text-align: left;
            padding: 0.875rem 1rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
        }
        
        .users-table tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s ease;
        }
        
        .users-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .users-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .users-table td {
            padding: 0.875rem 1rem;
            color: var(--text-dark);
            font-size: 0.9rem;
        }
        
        .text-secondary {
            color: var(--text-secondary);
        }
        
        .user-role-badge {
            display: inline-block;
            padding: 0.3rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .role-super_admin {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .role-admin {
            background: #fed7aa;
            color: #9a3412;
        }
        
        .role-editor {
            background: #dcfce7;
            color: #166534;
        }
        
        .role-viewer {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .user-status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.3rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-inactive {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .user-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-action-edit,
        .btn-action-delete {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.25rem 0.5rem;
            transition: transform 0.2s ease;
        }
        
        .btn-action-edit:hover,
        .btn-action-delete:hover {
            transform: scale(1.2);
        }
        
        .loading-users {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        .spinner-small {
            width: 30px;
            height: 30px;
            border: 3px solid #e5e7eb;
            border-top-color: var(--color-action);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 0.75rem;
        }
        
        .empty-users-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        /* Responsive */
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .user-management-modal {
                width: 100%;
                max-height: 100vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>

<div id="app" v-cloak>
    <!-- Login Modal -->
    <div v-if="!currentUser" class="modal-overlay">
        <div class="login-modal">
            <h2>–í—Ö–æ–¥ –≤ CMS</h2>
            <div v-if="loginError" class="login-error">{{ loginError }}</div>
            <form @submit.prevent="login">
                <div class="form-group">
                    <label for="username">–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="username" v-model="loginForm.username" required>
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" v-model="loginForm.password" required>
                </div>
                <button type="submit" class="btn-login" :disabled="isLoggingIn">
                    {{ isLoggingIn ? '–í—Ö–æ–¥...' : '–í–æ–π—Ç–∏' }}
                </button>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <template v-if="currentUser">
        <!-- Header -->
        <header class="admin-header">
            <h1>Healthcare Brazil CMS</h1>
            <div class="user-info">
                <span class="user-name">üë§ {{ currentUser.username }}</span>
                <!-- –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è super_admin) -->
                <button 
                    v-if="currentUser && currentUser.role === 'super_admin'" 
                    class="btn-manage-users" 
                    @click="openUserManagement"
                    title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏">
                    üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </button>
                <button class="btn-logout" @click="logout">–í—ã–π—Ç–∏</button>
            </div>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Page Header -->
            <div class="page-header">
                <h2>–°—Ç—Ä–∞–Ω–∏—Ü—ã</h2>
                <button class="btn-create" @click="createNewPage">
                    <span>+</span>
                    –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </button>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="search-box">
                    <input
                        type="text"
                        v-model="searchQuery"
                        placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ slug..."
                    >
                </div>
                <div class="filter-group">
                    <button
                        class="filter-btn"
                        :class="{ active: statusFilter === 'all' }"
                        @click="statusFilter = 'all'"
                    >
                        –í—Å–µ
                    </button>
                    <button
                        class="filter-btn"
                        :class="{ active: statusFilter === 'draft' }"
                        @click="statusFilter = 'draft'"
                    >
                        –ß–µ—Ä–Ω–æ–≤–∏–∫–∏
                    </button>
                    <button
                        class="filter-btn"
                        :class="{ active: statusFilter === 'published' }"
                        @click="statusFilter = 'published'"
                    >
                        –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div v-if="isLoading" class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü...</p>
            </div>

            <!-- Pages Table -->
            <div v-else-if="filteredPages.length > 0" class="pages-table">
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>Slug</th>
                                <th>–¢–∏–ø</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–°–æ–∑–¥–∞–Ω–∞</th>
                                <th>–û–±–Ω–æ–≤–ª–µ–Ω–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="page in filteredPages" :key="page.id">
                                <td>
                                    <div class="page-title">{{ page.title }}</div>
                                </td>
                                <td>
                                    <div class="page-slug">/{{ page.slug }}</div>
                                </td>
                                <td>
                                    <span class="page-type">{{ page.type }}</span>
                                </td>
                                <td>
                                    <span class="page-status" :class="page.status">
                                        <span class="status-dot"></span>
                                        {{ getStatusLabel(page.status) }}
                                    </span>
                                </td>
                                <td>
                                    <div class="page-date">{{ formatDate(page.createdAt) }}</div>
                                </td>
                                <td>
                                    <div class="page-date">{{ formatDate(page.updatedAt) }}</div>
                                </td>
                                <td>
                                    <div class="page-actions">
                                        <button class="action-btn edit" @click="editPage(page.id)">
                                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </button>
                                        <button class="action-btn delete" @click="deletePage(page.id)">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Empty State -->
            <div v-else class="empty-state">
                <h3>–°—Ç—Ä–∞–Ω–∏—Ü –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å CMS</p>
                <button class="btn-create" @click="createNewPage">
                    <span>+</span>
                    –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </button>
            </div>
        </div>
    </template>

    <!-- Notification -->
    <div v-if="notification" class="notification" :class="notification.type">
        {{ notification.message }}
    </div>

    <!-- User Management Modal -->
    <div v-if="showUserManagementModal" class="modal-overlay" @click.self="closeUserManagementModal">
        <div class="user-management-modal">
            <div class="modal-header-bar">
                <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <button @click="closeUserManagementModal" class="modal-close-btn">‚úï</button>
            </div>
            
            <div class="modal-content-body">
                <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div v-if="showUserForm" class="user-form-section">
                    <h3>{{ currentEditingUser ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' : '‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }}</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="user-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                            <input 
                                id="user-username"
                                v-model="userForm.username" 
                                type="text" 
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                                :disabled="!!currentEditingUser"
                                required>
                            <small class="form-hint">–û—Ç 3 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤. –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è.</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="user-email">Email *</label>
                            <input 
                                id="user-email"
                                v-model="userForm.email" 
                                type="email" 
                                placeholder="email@example.com"
                                required>
                        </div>
                        
                        <div class="form-group">
                            <label for="user-password">
                                {{ currentEditingUser ? '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–µ—Ç–µ)' : '–ü–∞—Ä–æ–ª—å *' }}
                            </label>
                            <input 
                                id="user-password"
                                v-model="userForm.password" 
                                type="password" 
                                placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤"
                                :required="!currentEditingUser">
                            <small class="form-hint">–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤.</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="user-role">–†–æ–ª—å *</label>
                            <select id="user-role" v-model="userForm.role">
                                <option value="editor">–†–µ–¥–∞–∫—Ç–æ—Ä</option>
                                <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                                <option value="super_admin" v-if="currentUser.role === 'super_admin'">
                                    –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                </option>
                            </select>
                            <small class="form-hint">
                                <strong>–†–µ–¥–∞–∫—Ç–æ—Ä:</strong> —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü<br>
                                <strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</strong> + –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏<br>
                                <strong>–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω:</strong> + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                            </small>
                        </div>
                    </div>
                    
                    <div class="form-group-checkbox">
                        <label>
                            <input type="checkbox" v-model="userForm.is_active">
                            <span>–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button @click="saveUser" class="btn-save-user">
                            {{ currentEditingUser ? 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }}
                        </button>
                        <button @click="closeUserForm" class="btn-cancel-form">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è -->
                <div v-if="!showUserForm" class="create-user-section">
                    <button @click="openCreateUserForm" class="btn-create-user">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div class="users-list-section">
                    <h3>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    
                    <div v-if="isLoadingUsers" class="loading-users">
                        <div class="spinner-small"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                    </div>
                    
                    <table v-else-if="users.length > 0" class="users-table">
                        <thead>
                            <tr>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>Email</th>
                                <th>–†–æ–ª—å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–°–æ–∑–¥–∞–Ω</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="user in users" :key="user.id">
                                <td>
                                    <strong>{{ user.username }}</strong>
                                </td>
                                <td>{{ user.email }}</td>
                                <td>
                                    <span class="user-role-badge" :class="'role-' + user.role">
                                        {{ getRoleDisplayName(user.role) }}
                                    </span>
                                </td>
                                <td>
                                    <span class="user-status-badge" :class="user.is_active ? 'status-active' : 'status-inactive'">
                                        {{ user.is_active ? '‚úì –ê–∫—Ç–∏–≤–µ–Ω' : '‚úó –ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}
                                    </span>
                                </td>
                                <td class="text-secondary">{{ formatUserDate(user.created_at) }}</td>
                                <td>
                                    <div class="user-actions">
                                        <button 
                                            @click="editUser(user)" 
                                            class="btn-action-edit" 
                                            title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                            ‚úèÔ∏è
                                        </button>
                                        <button 
                                            v-if="user.id !== currentUser.id"
                                            @click="deleteUser(user.id)" 
                                            class="btn-action-delete" 
                                            title="–£–¥–∞–ª–∏—Ç—å">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div v-else class="empty-users-state">
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
import ApiClient from './api-client.js';

const { createApp } = Vue;

createApp({
    data() {
        return {
            currentUser: null,
            loginForm: {
                username: '',
                password: ''
            },
            loginError: '',
            isLoggingIn: false,

            pages: [],
            isLoading: true,
            searchQuery: '',
            statusFilter: 'all',

            notification: null,
            apiClient: null,
            
            // ===== USER MANAGEMENT =====
            showUserManagementModal: false,
            users: [],
            isLoadingUsers: false,
            currentEditingUser: null,
            showUserForm: false,
            userForm: {
                username: '',
                email: '',
                password: '',
                role: 'editor',
                is_active: true
            }
        };
    },

    computed: {
        filteredPages() {
            let filtered = this.pages;

            // Filter by status
            if (this.statusFilter !== 'all') {
                filtered = filtered.filter(page => page.status === this.statusFilter);
            }

            // Filter by search query
            if (this.searchQuery.trim()) {
                const query = this.searchQuery.toLowerCase();
                filtered = filtered.filter(page =>
                    page.title.toLowerCase().includes(query) ||
                    page.slug.toLowerCase().includes(query)
                );
            }

            return filtered;
        }
    },

    methods: {
        async login() {
            this.isLoggingIn = true;
            this.loginError = '';

            try {
                const response = await this.apiClient.login(
                    this.loginForm.username,
                    this.loginForm.password
                );

                if (response.success && response.token) {
                    this.currentUser = response.user;
                    localStorage.setItem('cms_current_user', JSON.stringify(response.user));
                    localStorage.setItem('cms_auth_token', response.token);

                    this.showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    await this.loadPages();
                } else {
                    this.loginError = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.';
                }
            } catch (error) {
                this.loginError = error.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
                console.error('Login error:', error);
            } finally {
                this.isLoggingIn = false;
            }
        },

        async logout() {
            try {
                await this.apiClient.logout();
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                this.currentUser = null;
                localStorage.removeItem('cms_current_user');
                localStorage.removeItem('cms_auth_token');
                this.pages = [];
                this.showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
            }
        },

        async loadPages() {
            this.isLoading = true;

            try {
                const response = await this.apiClient.getAllPages();
                this.pages = response.data || response || [];
                console.log('Loaded pages:', this.pages);
            } catch (error) {
                console.error('Error loading pages:', error);
                this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü: ' + error.message, 'error');
            } finally {
                this.isLoading = false;
            }
        },

        async createNewPage() {
            if (!this.currentUser) {
                this.showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
                return;
            }

            try {
                // –°–æ–∑–¥–∞—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ API
                const timestamp = Date.now();
                const pageData = {
                    title: `–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ${timestamp}`,
                    slug: `new-page-${timestamp}`,
                    type: 'regular',
                    createdBy: this.currentUser.id,
                    seoTitle: `–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ${timestamp}`,
                    seoDescription: '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
                    blocks: []
                };

                console.log('Creating page:', pageData);

                const response = await this.apiClient.createPage(pageData);
                console.log('Create page response:', response);

                const candidateIds = [
                    response && response.pageId,
                    response && response.page_id,
                    response && response.id,
                    response && response.data && response.data.pageId,
                    response && response.data && response.data.page_id,
                    response && response.data && response.data.id
                ].filter(Boolean);

                const newPageId = candidateIds.length > 0 ? candidateIds[0] : null;

                if (newPageId) {
                    this.showNotification('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                    await this.loadPages();

                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å ID –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    setTimeout(() => {
                        window.location.href = `./editor.html?id=${newPageId}`;
                    }, 500);
                } else {
                    const errorMessage = (response && response.error && response.error.message)
                        || (response && response.error)
                        || (response && response.message)
                        || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É';
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('Error creating page:', error);
                this.showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + error.message, 'error');
            }
        },

        editPage(pageId) {
            window.location.href = `./editor.html?id=${pageId}`;
        },

        async deletePage(pageId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                return;
            }

            try {
                await this.apiClient.deletePage(pageId);
                this.showNotification('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
                await this.loadPages();
            } catch (error) {
                console.error('Error deleting page:', error);
                this.showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        },

        getStatusLabel(status) {
            const labels = {
                'draft': '–ß–µ—Ä–Ω–æ–≤–∏–∫',
                'published': '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ',
                'archived': '–í –∞—Ä—Ö–∏–≤–µ'
            };
            return labels[status] || status;
        },

        formatDate(dateString) {
            if (!dateString) return '-';

            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffDays === 0) {
                return '–°–µ–≥–æ–¥–Ω—è';
            } else if (diffDays === 1) {
                return '–í—á–µ—Ä–∞';
            } else if (diffDays < 7) {
                return `${diffDays} –¥–Ω. –Ω–∞–∑–∞–¥`;
            }

            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        },

        showNotification(message, type = 'success') {
            this.notification = { message, type };
            setTimeout(() => {
                this.notification = null;
            }, 3000);
        },

        // ===== USER MANAGEMENT METHODS =====
        
        async openUserManagement() {
            this.showUserManagementModal = true;
            this.showUserForm = false;
            await this.loadUsers();
        },
        
        closeUserManagementModal() {
            this.showUserManagementModal = false;
            this.showUserForm = false;
            this.currentEditingUser = null;
            this.resetUserForm();
        },
        
        async loadUsers() {
            this.isLoadingUsers = true;
            console.log('[loadUsers] Starting to load users...');
        
            try {
                const response = await this.apiClient.get('/api/users');
                console.log('[loadUsers] API response:', response);
                
                if (response.error) {
                    throw new Error(response.error);
                }
                
                this.users = response;
                console.log('[loadUsers] Loaded users count:', this.users.length);
                console.log('[loadUsers] Users data:', this.users);
            } catch (error) {
                console.error('[loadUsers] Error loading users:', error);
                this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + error.message, 'error');
            } finally {
                this.isLoadingUsers = false;
            }
        },
        
        openCreateUserForm() {
            this.currentEditingUser = null;
            this.resetUserForm();
            this.showUserForm = true;
        },
        
        editUser(user) {
            console.log('Editing user:', user);
            
            this.currentEditingUser = user;
            this.userForm = {
                username: user.username,
                email: user.email,
                password: '',
                role: user.role,
                is_active: user.is_active
            };
            this.showUserForm = true;
        },
        
        closeUserForm() {
            this.showUserForm = false;
            this.currentEditingUser = null;
            this.resetUserForm();
        },
        
        resetUserForm() {
            this.userForm = {
                username: '',
                email: '',
                password: '',
                role: 'editor',
                is_active: true
            };
        },
        
        async saveUser() {
            console.log('Saving user:', {
                isEdit: !!this.currentEditingUser,
                username: this.userForm.username
            });
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!this.validateUserForm()) {
                return;
            }
            
            try {
                if (this.currentEditingUser) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const updateData = {
                        email: this.userForm.email,
                        role: this.userForm.role,
                        is_active: this.userForm.is_active
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –±—ã–ª –≤–≤–µ–¥—ë–Ω
                    if (this.userForm.password) {
                        updateData.password = this.userForm.password;
                    }
                    
                    const response = await this.apiClient.put(
                        `/api/users/${this.currentEditingUser.id}`,
                        updateData
                    );
                    
                    if (response.error) {
                        throw new Error(response.error);
                    }
                    
                    this.showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
                    console.log('User updated:', this.currentEditingUser.id);
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const response = await this.apiClient.post('/api/users', this.userForm);
                    
                    if (response.error) {
                        throw new Error(response.error);
                    }
                    
                    this.showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 'success');
                    console.log('User created:', response.user_id);
                }
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await this.loadUsers();
                this.closeUserForm();
                
            } catch (error) {
                console.error('Error saving user:', error);
                this.showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        },
        
        validateUserForm() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)
            if (!this.currentEditingUser) {
                if (!this.userForm.username || this.userForm.username.length < 3) {
                    this.showNotification('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞', 'error');
                    return false;
                }
                
                if (this.userForm.username.length > 50) {
                    this.showNotification('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 50 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return false;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
            if (!this.userForm.email) {
                this.showNotification('Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω', 'error');
                return false;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(this.userForm.email)) {
                this.showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email', 'error');
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤–≤–µ–¥—ë–Ω)
            if (!this.currentEditingUser || this.userForm.password) {
                if (!this.userForm.password || this.userForm.password.length < 8) {
                    this.showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return false;
                }
            }
            
            return true;
        },
        
        async deleteUser(userId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                return;
            }
            
            console.log('Deleting user:', userId);
            
            try {
                const response = await this.apiClient.delete(`/api/users/${userId}`);
                
                if (response.error) {
                    throw new Error(response.error);
                }
                
                this.showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω', 'success');
                console.log('User deleted:', userId);
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                await this.loadUsers();
                
            } catch (error) {
                console.error('Error deleting user:', error);
                this.showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        },
        
        getRoleDisplayName(role) {
            const roleNames = {
                'super_admin': '–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω',
                'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                'editor': '–†–µ–¥–∞–∫—Ç–æ—Ä',
                'viewer': '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å'
            };
            return roleNames[role] || role;
        },
        
        formatUserDate(dateString) {
            if (!dateString) return '‚Äî';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
    },

    async mounted() {
        // Initialize API client
        this.apiClient = new ApiClient();

        // Check if user is already logged in
        const savedUser = localStorage.getItem('cms_current_user');
        const token = localStorage.getItem('cms_auth_token');

        if (savedUser && token) {
            try {
                this.currentUser = JSON.parse(savedUser);

                // Verify token is still valid
                const user = await this.apiClient.getCurrentUser();
                this.currentUser = user;
                localStorage.setItem('cms_current_user', JSON.stringify(user));

                await this.loadPages();
            } catch (error) {
                console.error('Session expired:', error);
                localStorage.removeItem('cms_current_user');
                localStorage.removeItem('cms_auth_token');
                this.currentUser = null;
                this.isLoading = false;
            }
        } else {
            this.isLoading = false;
        }
    }
}).mount('#app');
</script>

</body>
</html>
