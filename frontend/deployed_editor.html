<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Visual Editor - Healthcare Brazil</title>

    <link rel="stylesheet" href="styles.css">

    <!-- Quill.js -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- Quill ImageResize Module -->
    <script src="https://unpkg.com/quill-image-resize-module@3.0.0/image-resize.min.js"></script>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        console.info('Healthcare CMS visual editor build 2025-10-05-1 loaded');
    </script>

    <style>
        /* Editor-specific styles */
        body {
            margin: 0;
            padding: 0;
            background: #2a2d3a;
        }

        [v-cloak] { display: none; }

        /* Editor Layout */
        .editor-wrapper {
            display: grid;
            grid-template-rows: auto 1fr;
            height: 100vh;
            overflow: hidden;
        }

        .editor-toolbar {
            background: var(--text-dark);
            color: var(--color-white);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 200;
        }

        .toolbar-title {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 600;
        }

        .toolbar-actions {
            display: flex;
            gap: 0.5rem;
        }

        .toolbar-btn {
            padding: 0.5rem 1.25rem;
            border-radius: 6px;
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toolbar-btn.save {
            background: rgba(255,255,255,0.1);
            color: var(--color-white);
        }

        .toolbar-btn.save:hover {
            background: rgba(255,255,255,0.2);
        }

        .toolbar-btn.export {
            background: var(--color-action);
            color: var(--color-white);
        }

        .toolbar-btn.export:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.4);
        }

        .editor-container {
            display: grid;
            grid-template-columns: 280px 1fr 380px;
            height: calc(100vh - 56px); /* ÐÑÑÐ¸ÑÐ°ÐµÐ¼ Ð²ÑÑÐ¾ÑÑ toolbar */
            gap: 0;
            overflow: hidden;
        }

        /* Left Panel - Blocks Library */
        .blocks-library {
            background: var(--bg-accent);
            border-right: 1px solid rgba(3, 42, 73, 0.1);
            overflow-y: auto;
            padding: 1.5rem;
        }

        .library-title {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }

        .library-blocks {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .library-block {
            background: var(--color-white);
            padding: 0.875rem;
            border-radius: 8px;
            border: 1px solid rgba(3, 42, 73, 0.08);
            cursor: grab;
            transition: border-color 0.2s ease;
            box-shadow: 0 2px 8px rgba(97, 110, 154, 0.05);
        }

        .library-block:hover {
            border-color: var(--color-action);
        }

        .library-block.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .library-block-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .library-block-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .library-block-icon svg {
            width: 24px;
            height: 24px;
        }

        .library-block-preview-icon {
            margin-left: auto;
            font-size: 1.2rem;
            opacity: 0.5;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.25rem;
            border-radius: 4px;
        }

        .library-block-preview-icon:hover {
            opacity: 1;
            background: rgba(0, 141, 141, 0.1);
            transform: scale(1.1);
        }

        /* Block Preview Modal */
        .block-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 2rem;
        }

        .block-preview-content {
            background: var(--bg-main);
            border-radius: 12px;
            max-width: 900px;
            max-height: 90vh;
            overflow: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .block-preview-header {
            position: sticky;
            top: 0;
            background: var(--text-dark);
            color: var(--color-white);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 12px 12px 0 0;
            z-index: 10;
        }

        .block-preview-title {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .block-preview-title svg {
            width: 24px;
            height: 24px;
        }

        .block-preview-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--color-white);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .block-preview-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .block-preview-body {
            padding: 2rem;
            min-height: 200px;
        }

        .library-block-name {
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-dark);
        }

        .library-block-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .library-divider {
            height: 1px;
            background: rgba(3, 42, 73, 0.1);
            margin: 1.5rem 0;
        }

        .library-templates-btn {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, var(--color-action), #006a6a);
            color: var(--color-white);
            border: none;
            border-radius: 8px;
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.2);
        }

        .library-templates-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 141, 141, 0.3);
        }

        /* Center - Preview Area */
        .preview-area {
            background: #d1d3e0;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease;
        }

        .preview-area.drag-over {
            background: #b8bbd0;
            box-shadow: inset 0 0 0 3px var(--color-action);
        }

        .preview-wrapper {
            background: var(--bg-main);
            margin: 40px auto;
            max-width: 1400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid #ccc;
            overflow: hidden;
            min-height: calc(100vh - 80px);
        }

        .block-item {
            position: relative;
            cursor: grab;
            transition: all 0.2s ease;
            border-top: 2px solid transparent;
            border-bottom: 2px solid transparent;
        }

        .block-item:hover {
            outline: 2px solid var(--color-action);
            outline-offset: -2px;
        }

        .block-item.selected {
            outline: 3px solid var(--color-action);
            outline-offset: -3px;
        }

        .block-item.dragging {
            opacity: 0.4;
            cursor: grabbing;
        }

        .block-item.drag-over-top {
            border-top: 4px solid var(--color-action) !important;
        }

        .block-item.drag-over-bottom {
            border-bottom: 4px solid var(--color-action) !important;
        }

        .block-custom-name {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: linear-gradient(135deg, var(--color-action), #006a6a);
            color: var(--color-white);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 9;
            box-shadow: 0 2px 8px rgba(0, 141, 141, 0.3);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .block-item:hover .block-custom-name,
        .block-item.selected .block-custom-name {
            opacity: 1;
        }

        .block-controls {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: none;
            gap: 0.25rem;
            z-index: 10;
        }

        .block-item:hover .block-controls,
        .block-item.selected .block-controls {
            display: flex;
        }

        .block-control-btn {
            background: var(--text-dark);
            color: var(--color-white);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .block-control-btn:hover {
            background: var(--color-action);
            transform: scale(1.1);
        }

        .block-control-btn.delete:hover {
            background: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 6rem 2rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Right Panel - Settings */
        .settings-panel {
            background: var(--bg-accent);
            border-left: 1px solid rgba(3, 42, 73, 0.1);
            overflow-y: auto;
            padding: 1.5rem;
        }

        .settings-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid rgba(3, 42, 73, 0.1);
        }

        .settings-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .settings-tab.active {
            color: var(--color-action);
            border-bottom-color: var(--color-action);
        }

        .settings-title {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1.5rem;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-label {
            display: block;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .settings-input,
        .settings-textarea,
        .settings-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(3, 42, 73, 0.2);
            border-radius: 6px;
            font-family: var(--font-body);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: var(--color-white);
        }

        .settings-input:focus,
        .settings-textarea:focus,
        .settings-select:focus {
            outline: none;
            border-color: var(--color-action);
            box-shadow: 0 0 0 3px rgba(0, 141, 141, 0.1);
        }

        .settings-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .settings-hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .block-type-badge {
            background: linear-gradient(135deg, var(--color-action), #006a6a);
            color: var(--color-white);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .block-type-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .block-type-icon svg {
            width: 24px;
            height: 24px;
        }

        .block-type-name {
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(3, 42, 73, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal-content {
            background: var(--color-white);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(3, 42, 73, 0.1);
        }

        .modal-header h2 {
            font-family: var(--font-heading);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .modal-header p {
            color: var(--text-secondary);
        }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .template-card {
            background: var(--color-white);
            border: 2px solid rgba(3, 42, 73, 0.1);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: var(--color-action);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 141, 141, 0.15);
        }

        .template-preview {
            font-size: 3.5rem;
            margin-bottom: 1rem;
        }

        .template-name {
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .template-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .template-blocks-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid rgba(3, 42, 73, 0.1);
            display: flex;
            justify-content: flex-end;
        }

        .modal-btn-cancel {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: var(--font-heading);
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel:hover {
            background: var(--bg-accent);
            color: var(--text-dark);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--color-white);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border-left: 4px solid var(--color-action);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.error {
            border-left-color: #dc2626;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Article Editor Mode */
        .article-editor-mode {
            position: fixed;
            inset: 0;
            background: var(--bg-main);
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }

        .article-editor-toolbar {
            background: var(--text-dark);
            color: var(--color-white);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .article-editor-title {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .article-editor-actions {
            display: flex;
            gap: 0.75rem;
        }

        .article-editor-btn {
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .article-editor-btn.close {
            background: rgba(255,255,255,0.1);
            color: var(--color-white);
        }

        .article-editor-btn.close:hover {
            background: rgba(255,255,255,0.2);
        }

        .article-editor-btn.save {
            background: var(--color-action);
            color: var(--color-white);
        }

        .article-editor-btn.save:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 141, 141, 0.4);
        }

        .article-editor-container {
            flex: 1;
            overflow-y: auto;
            padding: 3rem 2rem;
        }

        .article-editor-wrapper {
            max-width: 900px;
            margin: 0 auto;
            background: var(--color-white);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.08);
            padding: 3rem;
            min-height: 600px;
        }

        /* Quill editor styles */
        #quill-editor {
            height: 600px;
        }

        .ql-container {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            line-height: 1.8;
            color: #616E9A;
        }

        .ql-toolbar {
            background: var(--bg-accent) !important;
            border: none !important;
            border-bottom: 1px solid #ccc !important;
        }

        /* Styles inside Quill (matching prototype) */
        .ql-editor h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 3rem;
            text-align: center;
            margin: 3.5rem 0 2.5rem;
            color: #032A49;
            font-weight: 700;
        }

        .ql-editor h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            text-align: center;
            margin: 3rem 0 2rem;
            color: #032A49;
            font-weight: 600;
        }

        .ql-editor h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            margin: 2.5rem 0 1.5rem;
            color: #032A49;
            font-weight: 600;
        }

        .ql-editor h4 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            color: #032A49;
            font-weight: 600;
        }

        .ql-editor p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #616E9A;
            margin-bottom: 1rem;
        }

        .ql-editor blockquote {
            margin: 2rem 0;
            padding: 1rem 2rem;
            border-left: 4px solid #008d8d !important;
            background-color: #E9EAF2 !important;
            font-style: italic;
            font-size: 1.2rem;
            color: #032A49 !important;
            border-radius: 8px;
        }

        /* Ð¤Ð¾ÑÐ¼Ð°ÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð²Ð½ÑÑÑÐ¸ blockquote */
        .ql-editor blockquote strong {
            color: #032A49;
            font-weight: 600;
        }

        .ql-editor blockquote em {
            color: #032A49;
        }

        .ql-editor blockquote p {
            color: #032A49 !important;
        }

        /* Clearfix Ð´Ð»Ñ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ð¹ Ñ float */
        .ql-editor p:after {
            content: "";
            display: table;
            clear: both;
        }

        .ql-editor img {
            border-radius: 12px;
            max-width: 50%;
            height: auto;
            cursor: move;
        }

        /* ÐÐ·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ Ñ Ð¾Ð±ÑÐµÐºÐ°Ð½Ð¸ÐµÐ¼ */
        .ql-editor img[style*="float: left"],
        .ql-editor .ql-align-left img {
            float: left !important;
            margin: 0.5rem 2rem 1.5rem 0 !important;
        }

        .ql-editor img[style*="float: right"],
        .ql-editor .ql-align-right img {
            float: right !important;
            margin: 0.5rem 0 1.5rem 2rem !important;
        }

        /* ÐÐ·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÐµÐ½ÑÑÑ */
        .ql-editor .ql-align-center img,
        .ql-editor img:not([style*="float"]) {
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-top: 2rem;
            margin-bottom: 2rem;
            max-width: 70%;
        }

        /* Ð¡ÑÐ¸Ð»Ð¸ Ð´Ð»Ñ ImageResize handles */
        .ql-editor .ql-image-resize {
            position: relative;
            display: inline-block;
        }

        .ql-editor p {
            overflow: auto;
        }

        .ql-editor .image-style-side {
            float: right;
            margin-left: 2rem;
            margin-bottom: 1.5rem;
            max-width: 45%;
        }

        .ql-editor .image-style-align-left {
            float: left;
            margin-right: 2rem;
            margin-bottom: 1.5rem;
            max-width: 45%;
        }

        .ql-editor .image-style-align-right {
            float: right;
            margin-left: 2rem;
            margin-bottom: 1.5rem;
            max-width: 45%;
        }

        .ql-editor a {
            color: #008d8d;
            text-decoration: none;
            font-weight: 500;
        }

        /* Custom image controls */
        .ql-editor img {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ql-editor img:hover {
            box-shadow: 0 4px 12px rgba(0, 141, 141, 0.3);
        }

        .ql-editor img.img-small {
            max-width: 30% !important;
        }

        .ql-editor img.img-medium {
            max-width: 45% !important;
        }

        .ql-editor img.img-large {
            max-width: 70% !important;
        }

        .ql-editor img.img-full {
            max-width: 100% !important;
        }

        .ql-editor img.align-left {
            float: left;
            margin-right: 2rem;
            margin-bottom: 1.5rem;
        }

        .ql-editor img.align-right {
            float: right;
            margin-left: 2rem;
            margin-bottom: 1.5rem;
        }

        .ql-editor img.align-center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            float: none;
        }

        /* Image toolbar */
        .image-toolbar {
            position: fixed;
            background: white;
            border: 2px solid #008d8d;
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .image-toolbar button {
            padding: 0.5rem 0.75rem;
            background: var(--bg-accent);
            border: 1px solid #008d8d;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-dark);
            transition: all 0.2s ease;
        }

        .image-toolbar button:hover {
            background: #008d8d;
            color: white;
        }

        .image-toolbar button.active {
            background: #008d8d;
            color: white;
        }

        .ql-editor a:hover {
            text-decoration: underline;
        }

        .ql-editor ul,
        .ql-editor ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }

        .ql-editor li {
            margin-bottom: 0.5rem;
            line-height: 1.8;
        }

        /* Article content preview styles */
        .article-image-left {
            float: left;
            margin: 0 2rem 1.5rem 0;
            border-radius: 12px;
        }

        .article-image-right {
            float: right;
            margin: 0 0 1.5rem 2rem;
            border-radius: 12px;
        }

        .article-image-center {
            display: block;
            margin: 2rem auto;
            border-radius: 12px;
            max-width: 100%;
        }

        /* Debug Panel */
        .debug-panel {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 360px;
            max-height: 60vh;
            background: rgba(8, 15, 40, 0.95);
            color: #f1f5f9;
            border-radius: 12px;
            box-shadow: 0 18px 45px rgba(2, 12, 27, 0.6);
            display: flex;
            flex-direction: column;
            font-family: 'Inter', sans-serif;
            z-index: 1500;
            overflow: hidden;
            border: 1px solid rgba(148, 163, 184, 0.25);
        }

        .debug-panel.collapsed {
            height: auto;
            max-height: none;
        }

        .debug-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            background: rgba(15, 23, 42, 0.9);
        }

        .debug-panel-title {
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .debug-panel-actions {
            display: flex;
            gap: 0.4rem;
        }

        .debug-panel-button {
            background: rgba(148, 163, 184, 0.15);
            color: inherit;
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 6px;
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .debug-panel-button:hover {
            background: rgba(148, 163, 184, 0.25);
        }

        .debug-panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .debug-panel.collapsed .debug-panel-body {
            display: none;
        }

        .debug-message {
            border-radius: 8px;
            padding: 0.6rem 0.75rem;
            background: rgba(15, 23, 42, 0.65);
            border: 1px solid rgba(148, 163, 184, 0.15);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .debug-message.info {
            border-left: 3px solid #38bdf8;
        }

        .debug-message.success {
            border-left: 3px solid #34d399;
        }

        .debug-message.warning {
            border-left: 3px solid #fbbf24;
        }

        .debug-message.error {
            border-left: 3px solid #f87171;
        }

        .debug-message-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            opacity: 0.65;
            margin-bottom: 0.25rem;
        }

        .debug-message-text {
            font-weight: 500;
            margin-bottom: 0.35rem;
            word-break: break-word;
        }

        .debug-message-payload {
            background: rgba(148, 163, 184, 0.12);
            border-radius: 6px;
            padding: 0.5rem;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.7rem;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 160px;
            overflow: auto;
        }

        .debug-panel-empty {
            font-size: 0.75rem;
            text-align: center;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        <div class="editor-wrapper">
            <!-- Toolbar -->
            <div class="editor-toolbar">
                <div class="toolbar-title">
                    Healthcare Brazil - Visual Editor
                    <span v-if="currentUser" style="font-size: 0.85rem; margin-left: 1rem; opacity: 0.7;">
                        ð¤ {{ currentUser.username }}
                    </span>
                </div>
                <div class="toolbar-actions">
                    <button v-if="currentUser" @click="openArticleEditor" class="toolbar-btn save">
                        âï¸ ÐÐ°Ð¿Ð¸ÑÐ°ÑÑ ÑÑÐ°ÑÑÑ
                    </button>
                    <button v-if="currentUser" @click="openMediaLibrary" class="toolbar-btn save" title="ÐÑÐºÑÑÑÑ Ð¼ÐµÐ´Ð¸Ð°ÑÐµÐºÑ">
                        ð¼ï¸ ÐÐµÐ´Ð¸Ð°ÑÐµÐºÐ°
                    </button>
                    <button v-if="currentUser" @click="savePage" class="toolbar-btn save">
                        ð¾ Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ
                    </button>
                    <button v-if="currentUser && currentPageId && pageData.status === 'draft'" @click="publishPage" class="toolbar-btn export">
                        ð ÐÐ¿ÑÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°ÑÑ
                    </button>
                    <button v-if="currentUser" @click="exportHTML" class="toolbar-btn save">
                        ð¤ Ð­ÐºÑÐ¿Ð¾ÑÑ HTML
                    </button>
                    <button v-if="currentUser" @click="logout" class="toolbar-btn save" style="margin-left: 1rem;">
                        ðª ÐÑÑÐ¾Ð´
                    </button>
                </div>
            </div>

            <div class="editor-container">
                <!-- Left Panel - Blocks Library -->
                <div class="blocks-library">
                    <h2 class="library-title">ÐÐ¸Ð±Ð»Ð¸Ð¾ÑÐµÐºÐ° Ð±Ð»Ð¾ÐºÐ¾Ð²</h2>

                    <div class="library-blocks">
                        <div
                            v-for="block in blockDefinitions"
                            :key="block.type"
                            @click="addBlock(block)"
                            draggable="true"
                            @dragstart="onLibraryBlockDragStart($event, block)"
                            @dragend="onLibraryBlockDragEnd"
                            class="library-block"
                        >
                            <div class="library-block-header">
                                <span class="library-block-icon" v-html="block.icon"></span>
                                <span class="library-block-name">{{ block.name }}</span>
                                <span v-if="block.type !== 'spacer'"
                                      class="library-block-preview-icon"
                                      @click.stop="showBlockPreview(block)"
                                      title="ÐÑÐµÐ´Ð¿ÑÐ¾ÑÐ¼Ð¾ÑÑ Ð±Ð»Ð¾ÐºÐ°">
                                    ðï¸
                                </span>
                            </div>
                            <div class="library-block-desc">{{ block.description }}</div>
                        </div>
                    </div>

                    <div class="library-divider"></div>

                    <h3 class="library-title">ÐÐ¾ÑÐ¾Ð²ÑÐµ ÑÐ°Ð±Ð»Ð¾Ð½Ñ</h3>
                    <button @click="showTemplatesModal = true" class="library-templates-btn">
                        ð ÐÑÐ¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÑ ÑÐ°Ð±Ð»Ð¾Ð½
                    </button>
                </div>

                <!-- Center - Preview Area -->
                <div class="preview-area"
                     @drop="onPreviewDrop"
                     @dragover="onPreviewDragOver"
                     @dragleave="onPreviewDragLeave">
                    <div class="preview-wrapper">
                        <!-- Header -->
                        <header class="main-header">
                            <div class="container">
                                <a href="#" class="logo">{{ globalSettings.header.logoText }}</a>
                                <nav class="main-nav">
                                    <ul>
                                        <li v-for="(item, index) in globalSettings.header.navItems" :key="index">
                                            <a :href="item.link">{{ item.text }}</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </header>

                        <!-- Blocks -->
                        <main>
                            <div v-if="blocks.length === 0" class="empty-state">
                                <div class="empty-icon">ð¨</div>
                                <h3 style="font-family: var(--font-heading); color: var(--text-dark); margin-bottom: 0.5rem;">
                                    ÐÐ°ÑÐ½Ð¸ÑÐµ ÑÐ¾Ð·Ð´Ð°Ð²Ð°ÑÑ
                                </h3>
                                <p>ÐÐ¾Ð±Ð°Ð²ÑÑÐµ Ð¿ÐµÑÐ²ÑÐ¹ Ð±Ð»Ð¾Ðº Ð¸Ð· Ð±Ð¸Ð±Ð»Ð¸Ð¾ÑÐµÐºÐ¸ ÑÐ»ÐµÐ²Ð°</p>
                            </div>

                            <div v-else>
                                <div
                                    v-for="(block, index) in blocks"
                                    :key="index"
                                    @click="selectBlock(index)"
                                    draggable="true"
                                    @dragstart="onBlockDragStart($event, index)"
                                    @dragend="onBlockDragEnd"
                                    @dragover="onBlockDragOver($event, index)"
                                    @drop="onBlockDrop($event, index)"
                                    class="block-item"
                                    :class="{ 'selected': selectedBlockIndex === index, 'dragging': draggedBlockIndex === index }"
                                >
                                    <!-- Custom Block Name Label -->
                                    <div v-if="block.customName" class="block-custom-name">
                                        {{ block.customName }}
                                    </div>

                                    <!-- Block Controls -->
                                    <div class="block-controls">
                                        <button v-if="index > 0" @click.stop="moveBlockUp(index)" class="block-control-btn" title="ÐÐ²ÐµÑÑ">â²</button>
                                        <button v-if="index < blocks.length - 1" @click.stop="moveBlockDown(index)" class="block-control-btn" title="ÐÐ½Ð¸Ð·">â¼</button>
                                        <button @click.stop="duplicateBlock(index)" class="block-control-btn" title="ÐÑÐ±Ð»Ð¸ÑÐ¾Ð²Ð°ÑÑ">ð</button>
                                        <button @click.stop="removeBlock(index)" class="block-control-btn delete" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">ð</button>
                                    </div>

                                    <!-- Block Render -->
                                    <div v-html="renderBlock(block)"></div>
                                </div>
                            </div>
                        </main>

                        <!-- Footer -->
                        <footer class="main-footer">
                            <div class="container">
                                <a href="#" class="logo">{{ globalSettings.footer.logoText }}</a>
                                <p>{{ globalSettings.footer.copyrightText }}</p>
                                <p v-if="globalSettings.footer.privacyLink">
                                    <a :href="globalSettings.footer.privacyLink">{{ globalSettings.footer.privacyLinkText }}</a>
                                </p>
                            </div>
                        </footer>
                    </div>
                </div>

                <!-- Right Panel - Settings -->
                <div class="settings-panel">
                    <div class="settings-tabs">
                        <button
                            class="settings-tab"
                            :class="{ active: activeTab === 'page' }"
                            @click="activeTab = 'page'"
                        >
                            Ð¡ÑÑÐ°Ð½Ð¸ÑÐ°
                        </button>
                        <button
                            class="settings-tab"
                            :class="{ active: activeTab === 'block' }"
                            @click="activeTab = 'block'"
                        >
                            ÐÐ»Ð¾Ðº
                        </button>
                        <button
                            class="settings-tab"
                            :class="{ active: activeTab === 'global' }"
                            @click="activeTab = 'global'"
                        >
                            ÐÐ»Ð¾Ð±Ð°Ð»ÑÐ½ÑÐµ
                        </button>
                    </div>

                    <!-- Page Settings Tab -->
                    <div v-if="activeTab === 'page'">
                        <h3 class="settings-title">ÐÑÐ½Ð¾Ð²Ð½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ ÑÑÑÐ°Ð½Ð¸ÑÑ</h3>

                        <div class="settings-group">
                            <label class="settings-label">ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑÑÐ°Ð½Ð¸ÑÑ *</label>
                            <input
                                v-model="pageData.title"
                                @input="onTitleChange"
                                class="settings-input"
                                type="text"
                                placeholder="ÐÐ°Ð¿ÑÐ¸Ð¼ÐµÑ: ÐÐ»Ð°Ð²Ð½Ð°Ñ ÑÑÑÐ°Ð½Ð¸ÑÐ°"
                            >
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">
                                Slug (URL) *
                                <span v-if="autoGenerateSlug" style="color: var(--color-success); font-size: 0.75rem; margin-left: 0.5rem;">
                                    ð ÐÐ²ÑÐ¾Ð³ÐµÐ½ÐµÑÐ°ÑÐ¸Ñ Ð²ÐºÐ»ÑÑÐµÐ½Ð°
                                </span>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input
                                    v-model="pageData.slug"
                                    @input="onSlugManualEdit"
                                    class="settings-input"
                                    type="text"
                                    placeholder="home"
                                    style="flex: 1;"
                                >
                                <button
                                    v-if="!autoGenerateSlug && pageData.title && pageData.status !== 'published'"
                                    @click="regenerateSlug"
                                    class="toolbar-btn save"
                                    type="button"
                                    title="Ð¡Ð³ÐµÐ½ÐµÑÐ¸ÑÐ¾Ð²Ð°ÑÑ slug Ð¸Ð· ÑÐµÐºÑÑÐµÐ³Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ"
                                    style="padding: 0.5rem 1rem; white-space: nowrap;"
                                >
                                    ð ÐÐ±Ð½Ð¾Ð²Ð¸ÑÑ
                                </button>
                            </div>
                            <small style="color: var(--text-secondary); font-size: 0.75rem;">
                                <span v-if="autoGenerateSlug">Slug Ð°Ð²ÑÐ¾Ð¼Ð°ÑÐ¸ÑÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑÑÑ Ð¿ÑÐ¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ</span>
                                <span v-else>Slug Ð·Ð°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½. ÐÐ°Ð¶Ð¼Ð¸ÑÐµ "ð ÐÐ±Ð½Ð¾Ð²Ð¸ÑÑ" ÑÑÐ¾Ð±Ñ ÑÐ³ÐµÐ½ÐµÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¸Ð· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ</span>
                            </small>
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">Ð¢Ð¸Ð¿ ÑÑÑÐ°Ð½Ð¸ÑÑ</label>
                            <select v-model="pageData.type" class="settings-input">
                                <option value="regular">ÐÐ±ÑÑÐ½Ð°Ñ ÑÑÑÐ°Ð½Ð¸ÑÐ°</option>
                                <option value="home">ÐÐ»Ð°Ð²Ð½Ð°Ñ ÑÑÑÐ°Ð½Ð¸ÑÐ°</option>
                                <option value="article">Ð¡ÑÐ°ÑÑÑ</option>
                                <option value="guide">ÐÐ°Ð¹Ð´</option>
                            </select>
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">Ð¡ÑÐ°ÑÑÑ</label>
                            <div style="padding: 0.5rem; background: var(--bg-accent); border-radius: 6px; font-weight: 600;">
                                <span v-if="pageData.status === 'draft'" style="color: #f59e0b;">ð Ð§ÐµÑÐ½Ð¾Ð²Ð¸Ðº</span>
                                <span v-if="pageData.status === 'published'" style="color: #10b981;">â ÐÐ¿ÑÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð¾</span>
                            </div>
                        </div>

                        <h3 class="settings-title" style="margin-top: 2rem;">SEO Ð¼ÐµÑÐ°Ð´Ð°Ð½Ð½ÑÐµ</h3>

                        <div class="settings-group">
                            <label class="settings-label">SEO Title</label>
                            <input
                                v-model="pageData.seoTitle"
                                class="settings-input"
                                type="text"
                                placeholder="ÐÑÑÐ°Ð²ÑÑÐµ Ð¿ÑÑÑÑÐ¼, ÑÑÐ¾Ð±Ñ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÑ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑÑÐ°Ð½Ð¸ÑÑ"
                            >
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">SEO Description</label>
                            <textarea
                                v-model="pageData.seoDescription"
                                class="settings-textarea"
                                rows="3"
                                placeholder="ÐÑÐ°ÑÐºÐ¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÑÑÑÐ°Ð½Ð¸ÑÑ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²ÑÑ ÑÐ¸ÑÑÐµÐ¼"
                            ></textarea>
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">SEO Keywords</label>
                            <input
                                v-model="pageData.seoKeywords"
                                class="settings-input"
                                type="text"
                                placeholder="Ð·Ð´ÑÐ°Ð²Ð¾Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ðµ, Ð±ÑÐ°Ð·Ð¸Ð»Ð¸Ñ, Ð¼ÐµÐ´Ð¸ÑÐ¸Ð½Ð°"
                            >
                        </div>

                        <div v-if="currentPageId" style="margin-top: 2rem; padding: 1rem; background: var(--bg-accent); border-radius: 8px;">
                            <small style="color: var(--text-secondary); font-size: 0.75rem;">
                                <strong>ID ÑÑÑÐ°Ð½Ð¸ÑÑ:</strong> {{ currentPageId }}<br>
                                <strong>Ð ÐµÐ¶Ð¸Ð¼:</strong> {{ isEditMode ? 'Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ' : 'Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ' }}
                            </small>
                        </div>
                        <!-- ========================= MENU SETTINGS ========================= -->
                        <h3 class="settings-title" style="margin-top: 2rem;">ÐÐ°Ð²Ð¸Ð³Ð°ÑÐ¸Ñ (Ð¼ÐµÐ½Ñ)</h3>

                        <div class="settings-group">
                            <label class="settings-label">
                                <input type="checkbox" v-model="pageSettings.showInMenu" :disabled="pageData.status !== 'published'">
                                ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ð¼ Ð¼ÐµÐ½Ñ
                            </label>
                            <small class="settings-hint">
                                <span v-if="pageData.status !== 'published'" style="color: #dc3545;">â ï¸ ÐÐ¾ÑÑÑÐ¿Ð½Ð¾ ÑÐ¾Ð»ÑÐºÐ¾ Ð´Ð»Ñ Ð¾Ð¿ÑÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð½ÑÑ ÑÑÑÐ°Ð½Ð¸Ñ</span>
                                <span v-else>â Ð¡ÑÑÐ°Ð½Ð¸ÑÐ° Ð±ÑÐ´ÐµÑ Ð¾ÑÐ¾Ð±ÑÐ°Ð¶Ð°ÑÑÑÑ Ð² Ð²ÐµÑÑÐ½ÐµÐ¼ Ð¼ÐµÐ½Ñ ÑÐ°Ð¹ÑÐ°</span>
                            </small>
                        </div>

                        <div class="settings-group" v-if="pageSettings.showInMenu && pageData.status === 'published'">
                            <label class="settings-label">ÐÐ¾ÑÑÐ´Ð¾Ðº Ð² Ð¼ÐµÐ½Ñ</label>
                            <input type="number" v-model.number="pageSettings.menuPosition" class="settings-input" min="0" placeholder="ÐÐ²ÑÐ¾Ð¼Ð°ÑÐ¸ÑÐµÑÐºÐ¸">
                            <small class="settings-hint">ÐÐµÐ½ÑÑÐµÐµ ÑÐ¸ÑÐ»Ð¾ = Ð²ÑÑÐµ Ð² Ð¼ÐµÐ½Ñ (0 Ð¸Ð»Ð¸ Ð¿ÑÑÑÐ¾ = Ð°Ð²ÑÐ¾Ð¼Ð°ÑÐ¸ÑÐµÑÐºÐ°Ñ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ)</small>
                        </div>

                        <div class="settings-group" v-if="pageSettings.showInMenu && pageData.status === 'published'">
                            <label class="settings-label">ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð² Ð¼ÐµÐ½Ñ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)</label>
                            <input type="text" v-model="pageSettings.menuTitle" class="settings-input" maxlength="80" placeholder="Будет использовано название страницы">
                            <small class="settings-hint">ÐÑÐ»Ð¸ Ð½Ðµ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ â Ð±ÑÐ´ÐµÑ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°Ð½Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑÑÐ°Ð½Ð¸ÑÑ</small>
                        </div>

                        <div class="menu-preview" v-if="pageSettings.showInMenu && pageData.title">
                            <strong>ÐÑÐµÐ²ÑÑ Ð¿ÑÐ½ÐºÑÐ° Ð¼ÐµÐ½Ñ:</strong>
                            <div class="preview-item">📍 {{ pageSettings.menuTitle || pageData.title }}</div>
                        </div>
                    </div>

                    <!-- Block Settings Tab -->
                    <div v-if="activeTab === 'block' && selectedBlock">
                        <div class="block-type-badge">
                            <span class="block-type-icon" v-html="getBlockIcon(selectedBlock.type)"></span>
                            <span class="block-type-name">{{ getBlockName(selectedBlock.type) }}</span>
                        </div>

                        <!-- Custom Block Name -->
                        <div class="settings-group" style="margin-top: 1.5rem;">
                            <label class="settings-label">ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð±Ð»Ð¾ÐºÐ° (ÐºÐ°ÑÑÐ¾Ð¼Ð½Ð¾Ðµ)</label>
                            <input
                                type="text"
                                v-model="selectedBlock.customName"
                                class="settings-input"
                                :placeholder="getBlockName(selectedBlock.type)"
                            >
                            <div class="settings-hint">ÐÑÑÐ°Ð²ÑÑÐµ Ð¿ÑÑÑÑÐ¼ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾ ÑÐ¼Ð¾Ð»ÑÐ°Ð½Ð¸Ñ</div>
                        </div>

                        <!-- Dynamic Block Settings -->
                        <template v-for="(value, key) in selectedBlock.data" :key="key">
                            <!-- Simple Text/Number Fields -->
                            <div v-if="typeof value === 'string' || typeof value === 'number'" class="settings-group">
                                <label class="settings-label">{{ formatLabel(key) }}</label>
                                <input
                                    v-if="isDimensionKey(key)"
                                    type="text"
                                    v-model="selectedBlock.data[key]"
                                    class="settings-input"
                                >
                                <textarea
                                    v-else-if="isRichTextKey(key)"
                                    v-model="selectedBlock.data[key]"
                                    class="settings-textarea"
                                    rows="4"
                                ></textarea>
                                <div v-else-if="isImageKey(key)" style="display: flex; gap: 0.5rem;">
                                    <input
                                        type="text"
                                        v-model="selectedBlock.data[key]"
                                        class="settings-input"
                                        style="flex: 1;"
                                    >
                                    <button
                                        @click="openGallery(key)"
                                        style="padding: 0.75rem 1rem; background: var(--color-action); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; flex-shrink: 0;"
                                        title="ÐÑÐ±ÑÐ°ÑÑ Ð¸Ð· Ð³Ð°Ð»ÐµÑÐµÐ¸"
                                    >
                                        ð
                                    </button>
                                </div>
                                <input
                                    v-else
                                    type="text"
                                    v-model="selectedBlock.data[key]"
                                    class="settings-input"
                                >
                            </div>

                            <!-- Array Fields (Cards, Paragraphs, etc.) -->
                            <div v-else-if="Array.isArray(value)" class="settings-group">
                                <label class="settings-label">{{ formatLabel(key) }}</label>

                                <!-- Array of Strings (e.g., paragraphs) -->
                                <template v-if="value.length > 0 && typeof value[0] === 'string'">
                                    <div v-for="(item, index) in value" :key="index" style="background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                            <strong style="font-size: 0.85rem; color: var(--text-dark);">{{ formatLabel(key) }} #{{ index + 1 }}</strong>
                                            <button
                                                @click="removeArrayItem(key, index)"
                                                style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem;"
                                            >
                                                Ð£Ð´Ð°Ð»Ð¸ÑÑ
                                            </button>
                                        </div>
                                        <textarea
                                            v-model="value[index]"
                                            class="settings-input"
                                            style="min-height: 80px; font-size: 0.8rem;"
                                        ></textarea>
                                    </div>
                                </template>

                                <!-- Array of Objects (e.g., cards, messages) -->
                                <template v-else>
                                    <div v-for="(item, index) in value" :key="index" style="background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                            <strong style="font-size: 0.85rem; color: var(--text-dark);">{{ formatLabel(key) }} #{{ index + 1 }}</strong>
                                            <button
                                                @click="removeArrayItem(key, index)"
                                                style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem;"
                                            >
                                                Ð£Ð´Ð°Ð»Ð¸ÑÑ
                                            </button>
                                        </div>

                                        <template v-for="(itemValue, itemKey) in item" :key="itemKey">
                                            <div style="margin-bottom: 0.5rem;">
                                                <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">
                                                    {{ formatLabel(itemKey) }}
                                                </label>
                                                <textarea
                                                    v-if="itemKey === 'icon' || itemKey === 'answer' || itemKey === 'text'"
                                                    v-model="item[itemKey]"
                                                    class="settings-input"
                                                    style="min-height: 60px; font-size: 0.8rem;"
                                                ></textarea>
                                                <div v-else-if="isImageKey(itemKey)" style="display: flex; gap: 0.5rem;">
                                                    <input
                                                        type="text"
                                                        v-model="item[itemKey]"
                                                        class="settings-input"
                                                        style="font-size: 0.8rem; flex: 1;"
                                                    >
                                                    <button
                                                        @click="openGalleryForArrayItem(key, index, itemKey)"
                                                        style="padding: 0.5rem 0.75rem; background: var(--color-action); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease; flex-shrink: 0;"
                                                        title="ÐÑÐ±ÑÐ°ÑÑ Ð¸Ð· Ð³Ð°Ð»ÐµÑÐµÐ¸"
                                                    >
                                                        ð
                                                    </button>
                                                </div>
                                                <input
                                                    v-else
                                                    type="text"
                                                    v-model="item[itemKey]"
                                                    class="settings-input"
                                                    style="font-size: 0.8rem;"
                                                >
                                            </div>
                                        </template>
                                    </div>
                                </template>

                                <button
                                    @click="addArrayItem(key)"
                                    style="width: 100%; padding: 0.5rem; background: var(--color-action); color: white; border: none; border-radius: 6px; cursor: pointer; font-family: var(--font-heading); font-weight: 600; font-size: 0.85rem;"
                                >
                                    + ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ {{ formatLabel(key) }}
                                </button>
                            </div>
                        </template>
                    </div>

                    <!-- Global Settings Tab -->
                    <div v-if="activeTab === 'global'">
                        <h3 class="settings-title">Header</h3>

                        <div class="settings-group">
                            <label class="settings-label">ÐÐ¾Ð³Ð¾ÑÐ¸Ð¿</label>
                            <input v-model="globalSettings.header.logoText" class="settings-input" type="text">
                        </div>

                        <h3 class="settings-title" style="margin-top: 2rem;">Footer</h3>

                        <div class="settings-group">
                            <label class="settings-label">ÐÐ¾Ð³Ð¾ÑÐ¸Ð¿</label>
                            <input v-model="globalSettings.footer.logoText" class="settings-input" type="text">
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">Copyright ÑÐµÐºÑÑ</label>
                            <input v-model="globalSettings.footer.copyrightText" class="settings-input" type="text">
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Privacy Policy</label>
                            <input v-model="globalSettings.footer.privacyLink" class="settings-input" type="text" placeholder="#privacy">
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">Ð¢ÐµÐºÑÑ ÑÑÑÐ»ÐºÐ¸ Privacy</label>
                            <input v-model="globalSettings.footer.privacyLinkText" class="settings-input" type="text">
                        </div>

                        <h3 class="settings-title" style="margin-top: 2rem;">Cookie Banner</h3>

                        <div class="settings-group">
                            <label class="settings-label">
                                <input type="checkbox" v-model="globalSettings.cookieBanner.enabled"> ÐÐºÐ»ÑÑÐ¸ÑÑ Cookie Banner
                            </label>
                        </div>

                        <div v-if="globalSettings.cookieBanner.enabled">
                            <div class="settings-group">
                                <label class="settings-label">Ð¢ÐµÐºÑÑ ÑÐ¾Ð¾Ð±ÑÐµÐ½Ð¸Ñ</label>
                                <textarea v-model="globalSettings.cookieBanner.message" class="settings-textarea" rows="3"></textarea>
                            </div>

                            <div class="settings-group">
                                <label class="settings-label">Ð¢ÐµÐºÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐÑÐ¸Ð½ÑÑÑ"</label>
                                <input v-model="globalSettings.cookieBanner.acceptText" class="settings-input" type="text">
                            </div>

                            <div class="settings-group">
                                <label class="settings-label">Ð¢ÐµÐºÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÐµÐµ"</label>
                                <input v-model="globalSettings.cookieBanner.detailsText" class="settings-input" type="text">
                            </div>
                        </div>
                    </div>

                    <div v-if="activeTab === 'block' && !selectedBlock" class="empty-state" style="padding: 4rem 1rem;">
                        <div class="empty-icon" style="font-size: 3rem;">ð</div>
                        <p style="font-size: 0.875rem;">ÐÑÐ±ÐµÑÐ¸ÑÐµ Ð±Ð»Ð¾Ðº Ð´Ð»Ñ ÑÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ñ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Templates Modal -->
        <div v-if="showTemplatesModal" class="modal-overlay" @click.self="showTemplatesModal = false">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÐÑÐ±ÐµÑÐ¸ÑÐµ ÑÐ°Ð±Ð»Ð¾Ð½ ÑÑÑÐ°Ð½Ð¸ÑÑ</h2>
                    <p>ÐÐ¾ÑÐ¾Ð²ÑÐµ ÑÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð· Ð¿ÑÐ¾ÑÐ¾ÑÐ¸Ð¿Ð° - Ð¿ÑÐ¾ÑÑÐ¾ Ð²ÑÐ±ÐµÑÐ¸ÑÐµ Ð¸ Ð½Ð°ÑÐ½Ð¸ÑÐµ ÑÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ</p>
                </div>

                <div class="modal-body">
                    <div class="templates-grid">
                        <div
                            v-for="template in pageTemplates"
                            :key="template.id"
                            @click="applyTemplate(template)"
                            class="template-card"
                        >
                            <div class="template-preview">{{ template.preview }}</div>
                            <h3 class="template-name">{{ template.name }}</h3>
                            <p class="template-desc">{{ template.description }}</p>
                            <div class="template-blocks-count">{{ template.blocks.length }} Ð±Ð»Ð¾ÐºÐ¾Ð²</div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button @click="showTemplatesModal = false" class="modal-btn-cancel">
                        ÐÑÐ¼ÐµÐ½Ð°
                    </button>
                </div>
            </div>
        </div>

        <!-- Gallery Modal -->
        <div v-if="showGalleryModal" class="modal-overlay" @click.self="showGalleryModal = false">
            <div class="modal-content">
                <div class="modal-header" style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                        <div>
                            <h2>ÐÐ°Ð»ÐµÑÐµÑ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ð¹</h2>
                            <p>ÐÐ°Ð³ÑÑÐ·Ð¸ÑÐµ Ð½Ð¾Ð²Ð¾Ðµ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ Ð²ÑÐ±ÐµÑÐ¸ÑÐµ Ð¸Ð· ÑÐ¶Ðµ Ð·Ð°Ð³ÑÑÐ¶ÐµÐ½Ð½ÑÑ</p>
                        </div>
                        <button
                            @click="openMediaLibrary"
                            style="padding: 0.65rem 1.1rem; border-radius: 8px; border: 1px solid rgba(3, 42, 73, 0.15); background: white; color: var(--color-action); font-family: var(--font-heading); font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 0.4rem;"
                            type="button"
                        >
                            ð ÐÑÐºÑÑÑÑ Ð¼ÐµÐ´Ð¸Ð°ÑÐµÐºÑ
                        </button>
                    </div>
                </div>

                <div class="modal-body">
                    <!-- Upload Area -->
                    <div style="margin-bottom: 2rem;">
                        <label style="display: block; width: 100%; padding: 2rem; border: 2px dashed var(--color-action); border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: rgba(0, 141, 141, 0.03);">
                            <input type="file" @change="handleFileUpload" accept="image/*" style="display: none;">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ð¤</div>
                            <div style="font-family: var(--font-heading); font-weight: 600; color: var(--color-action); margin-bottom: 0.25rem;">
                                ÐÐ°Ð³ÑÑÐ·Ð¸ÑÑ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ
                            </div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                ÐÐ°Ð¶Ð¼Ð¸ÑÐµ Ð¸Ð»Ð¸ Ð¿ÐµÑÐµÑÐ°ÑÐ¸ÑÐµ ÑÐ°Ð¹Ð» (Ð¼Ð°ÐºÑ. 5MB)
                            </div>
                        </label>
                        <div v-if="uploadProgress" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--color-action);">
                            {{ uploadProgress }}
                        </div>
                    </div>

                    <!-- Gallery Grid -->
                    <div v-if="galleryImages.length > 0">
                        <h3 style="font-family: var(--font-heading); font-size: 1rem; font-weight: 600; color: var(--text-dark); margin-bottom: 1rem;">
                            ÐÐ°Ð³ÑÑÐ¶ÐµÐ½Ð½ÑÐµ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ñ ({{ galleryImages.length }})
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
                            <div
                                v-for="image in galleryImages"
                                :key="image.id"
                                @click="selectImageFromGallery(image)"
                                style="position: relative; aspect-ratio: 1; border-radius: 8px; overflow: hidden; cursor: pointer; border: 2px solid transparent; transition: all 0.3s ease;"
                                :style="{ borderColor: selectedGalleryImage && selectedGalleryImage.id === image.id ? 'var(--color-action)' : 'transparent' }"
                                @mouseenter="$event.currentTarget.style.transform = 'scale(1.05)'"
                                @mouseleave="$event.currentTarget.style.transform = 'scale(1)'"
                            >
                                <img :src="image.displayUrl" :alt="image.filename" style="width: 100%; height: 100%; object-fit: cover;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(3, 42, 73, 0.9), transparent); padding: 0.5rem; color: white; font-size: 0.7rem; font-weight: 600; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;">
                                    {{ image.filename }}
                                </div>
                                <button
                                    @click.stop="deleteImage(image)"
                                    style="position: absolute; top: 0.5rem; right: 0.5rem; background: rgba(220, 38, 38, 0.9); color: white; border: none; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; transition: all 0.2s ease; opacity: 0;"
                                    @mouseenter="$event.currentTarget.style.opacity = '1'"
                                    @mouseleave="$event.currentTarget.style.opacity = '0'"
                                    title="Ð£Ð´Ð°Ð»Ð¸ÑÑ"
                                >
                                    ð
                                </button>
                            </div>
                        </div>
                    </div>
                    <div v-else style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">ð¼</div>
                        <p>ÐÐ¾ÐºÐ° Ð½ÐµÑ Ð·Ð°Ð³ÑÑÐ¶ÐµÐ½Ð½ÑÑ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ð¹</p>
                        <p style="font-size: 0.875rem;">ÐÐ°Ð³ÑÑÐ·Ð¸ÑÐµ Ð¿ÐµÑÐ²Ð¾Ðµ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ Ð²ÑÑÐµ</p>
                    </div>
                </div>

                <div class="modal-footer">
                    <button @click="showGalleryModal = false" class="modal-btn-cancel">
                        ÐÐ°ÐºÑÑÑÑ
                    </button>
                    <button
                        v-if="selectedGalleryImage"
                        @click="confirmImageSelection"
                        style="padding: 0.75rem 1.5rem; background: var(--color-action); color: white; border: none; border-radius: 8px; font-family: var(--font-heading); font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-left: 0.5rem;"
                    >
                        ÐÑÐ±ÑÐ°ÑÑ Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ
                    </button>
                </div>
            </div>
        </div>

        <!-- Article Editor Mode -->
        <div v-if="showArticleEditor" class="article-editor-mode">
            <div class="article-editor-toolbar">
                <div class="article-editor-title">âï¸ Ð ÐµÐ´Ð°ÐºÑÐ¾Ñ ÑÑÐ°ÑÐµÐ¹</div>
                <div class="article-editor-actions">
                    <button @click="closeArticleEditor" class="article-editor-btn close">
                        â ÐÐ°ÐºÑÑÑÑ
                    </button>
                    <button @click="saveArticleAndClose" class="article-editor-btn save">
                        â Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸ Ð·Ð°ÐºÑÑÑÑ
                    </button>
                </div>
            </div>
            <div class="article-editor-container">
                <div class="article-editor-wrapper">
                    <div id="quill-editor"></div>
                </div>
            </div>
        </div>

        <!-- Block Preview Modal -->
        <div v-if="previewBlock" class="block-preview-modal" @click.self="previewBlock = null">
            <div class="block-preview-content">
                <div class="block-preview-header">
                    <div class="block-preview-title">
                        <span style="margin-right: 0.5rem;" v-html="previewBlock.icon"></span>
                        {{ previewBlock.name }}
                    </div>
                    <button @click="previewBlock = null" class="block-preview-close">â</button>
                </div>
                <div class="block-preview-body" v-html="renderPreviewBlock()"></div>
            </div>
        </div>

        <!-- Login Modal -->
        <div v-if="showLoginModal" class="modal-overlay" style="z-index: 9999;">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2>ÐÑÐ¾Ð´ Ð² CMS</h2>
                    <p>ÐÐ²ÐµÐ´Ð¸ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ Ð´Ð»Ñ Ð²ÑÐ¾Ð´Ð° Ð² ÑÐ¸ÑÑÐµÐ¼Ñ</p>
                </div>

                <div class="modal-body">
                    <div class="settings-group">
                        <label class="settings-label">ÐÐ¼Ñ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ</label>
                        <input
                            v-model="loginForm.username"
                            @keyup.enter="login"
                            class="settings-input"
                            type="text"
                            placeholder="anna"
                            autofocus
                        >
                    </div>

                    <div class="settings-group">
                        <label class="settings-label">ÐÐ°ÑÐ¾Ð»Ñ</label>
                        <input
                            v-model="loginForm.password"
                            @keyup.enter="login"
                            class="settings-input"
                            type="password"
                            placeholder="â¢â¢â¢â¢â¢â¢â¢â¢"
                        >
                    </div>
                </div>

                <div class="modal-footer">
                    <button
                        @click="login"
                        style="width: 100%; padding: 0.75rem 1.5rem; background: var(--color-action); color: white; border: none; border-radius: 8px; font-family: var(--font-heading); font-weight: 600; cursor: pointer; transition: all 0.3s ease;"
                    >
                        ð ÐÐ¾Ð¹ÑÐ¸
                    </button>
                </div>
            </div>
        </div>

        <!-- Debug Panel -->
        <div
            v-if="debugPanelEnabled"
            class="debug-panel"
            :class="{ collapsed: debugPanelCollapsed }"
        >
            <div class="debug-panel-header">
                <div class="debug-panel-title">
                    ð  Debug Panel
                    <span style="font-size: 0.7rem; opacity: 0.65;">{{ debugMessages.length }} ÑÐ¾Ð±ÑÑÐ¸Ð¹</span>
                </div>
                <div class="debug-panel-actions">
                    <button class="debug-panel-button" @click="clearDebugLog" type="button">ÐÑÐ¸ÑÑÐ¸ÑÑ</button>
                    <button class="debug-panel-button" @click="toggleDebugPanel" type="button">
                        {{ debugPanelCollapsed ? 'Ð Ð°Ð·Ð²ÐµÑÐ½ÑÑÑ' : 'Ð¡ÐºÑÑÑÑ' }}
                    </button>
                </div>
            </div>
            <div class="debug-panel-body" ref="debugPanelBody">
                <div v-if="debugMessages.length === 0" class="debug-panel-empty">
                    ÐÐ¾Ð³Ð¸ Ð¿Ð¾ÑÐ²ÑÑÑÑ Ð¿Ð¾ÑÐ»Ðµ Ð´ÐµÐ¹ÑÑÐ²Ð¸Ð¹ Ð² ÑÐµÐ´Ð°ÐºÑÐ¾ÑÐµ
                </div>
                <div
                    v-for="msg in debugMessages"
                    :key="msg.id"
                    class="debug-message"
                    :class="msg.type"
                >
                    <div class="debug-message-header">
                        <span>{{ msg.time }}</span>
                        <span>{{ msg.type.toUpperCase() }}</span>
                    </div>
                    <div class="debug-message-text">{{ msg.message }}</div>
                    <pre v-if="msg.payload" class="debug-message-payload">{{ msg.payload }}</pre>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div
            v-if="notification"
            class="notification"
            :class="{ 'error': notification.type === 'error' }"
            :style="notificationStyle"
        >
            {{ notification.message }}
        </div>
    </div>

    <script type="module" src="editor.js?v=1.3"></script>
</body>
</html>

