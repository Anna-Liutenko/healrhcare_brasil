# üìã –ê–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ Collection Pages: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**–¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞:** `fix/media-deletion-persistence-20251030`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û

---

## üéØ –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ò –ü–†–û–í–ï–†–ö–ò

### –ò–∑ `Project_Functionality.md`:

#### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 1: –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

- **Use Case:** `backend/src/Application/UseCase/GetCollectionItems.php`
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É-–∫–æ–ª–ª–µ–∫—Ü–∏—é
  - –ß–∏—Ç–∞–µ—Ç `collectionConfig` (sourceTypes, sortBy, sortOrder, sections)
  - –§–∏–ª—å—Ç—Ä—É–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —Ç–∏–ø–∞–º (article, guide)
  - –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ publishedAt (DESC –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - –ü–∞–≥–∏–Ω–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (limit 12 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - **–ö–æ–¥ –ø—Ä–∞–≤–∏–ª–µ–Ω:** ‚úÖ –õ–∏–Ω–∏–∏ 31-135

#### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –∏–∑ HTML
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

- **Controller:** `backend/src/Presentation/Controller/PublicPageController.php`
  - –ú–µ—Ç–æ–¥ `renderCollectionPage()` –≤—ã–∑—ã–≤–∞–µ—Ç GetCollectionItems
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `CollectionHtmlBuilder` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML
  - –ü–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (sections, pagination, items)
  - **–ö–æ–¥ –ø—Ä–∞–≤–∏–ª–µ–Ω:** ‚úÖ –õ–∏–Ω–∏–∏ 601-662

#### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 3: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

- **Frontend:** `frontend/editor.js`
  - –ú–µ—Ç–æ–¥—ã:
    - `loadCollectionItems()` (–ª–∏–Ω–∏—è 1466) - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã
    - `updateCardImage()` (–ª–∏–Ω–∏—è 1513) - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É —á–µ—Ä–µ–∑ API
    - `changeCardImage()` - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–∞–ª–µ—Ä–µ—é
    - `loadCollectionPrevPage()` / `loadCollectionNextPage()` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
    - `switchCollectionSection()` - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–µ–∫—Ü–∏–∏

- **Backend API:** `backend/src/Presentation/Controller/CollectionController.php`
  - –ú–µ—Ç–æ–¥ `updateCardImage()` –æ–±–Ω–æ–≤–ª—è–µ—Ç `card_image` –≤ Page entity
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç URL (https/http, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, DNS check)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (Bearer token)
  - –õ–æ–≥–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (audit log)
  - **–ö–æ–¥ –ø—Ä–∞–≤–∏–ª–µ–Ω:** ‚úÖ –õ–∏–Ω–∏–∏ 132-222

#### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 4: API endpoints —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

- **–ú–∞—Ä—à—Ä—É—Ç—ã –≤ `backend/public/index.php`:**
  - `GET /api/pages/{id}/collection-items` - –ª–∏–Ω–∏—è 120
  - `PATCH /api/pages/{id}/card-image` - –ª–∏–Ω–∏—è 124

- **Endpoints –≤ CollectionController:**
  - `getItems()` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç GET /api/pages/:id/collection-items
  - `updateCardImage()` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç PATCH /api/pages/:id/card-image

---

## üèõÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê: Clean Architecture - –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï

### ‚úÖ –°–ª–æ–π 1: Domain Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)

**–§–∞–π–ª—ã:**
- `backend/src/Domain/Entity/Page.php`
- `backend/src/Domain/ValueObject/PageType.php`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `Page::getCardImage(?array $blocks = null): string`
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: cardImage (DB) ‚Üí cardImages (config) ‚Üí –±–ª–æ–∫–∏ ‚Üí fallback
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏
  
- ‚úÖ `Page::setCardImage(string $imageUrl): void`
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç timestamp
  
- ‚úÖ `PageType::isCollection(): bool`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π
  
**–í—ã–≤–æ–¥:** ‚úÖ Domain layer –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture

---

### ‚úÖ –°–ª–æ–π 2: Application Layer (Use Cases / Business Logic)

**–§–∞–π–ª—ã:**
- `backend/src/Application/UseCase/GetCollectionItems.php` (139 —Å—Ç—Ä–æ–∫)
- `backend/src/Application/UseCase/UpdateCollectionCardImage.php` (89 —Å—Ç—Ä–æ–∫)

**GetCollectionItems - –ü—Ä–æ–≤–µ—Ä–∫–∞:**
```php
// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:
1. ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É-–∫–æ–ª–ª–µ–∫—Ü–∏—é
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø (isCollection())
3. ‚úÖ –ß–∏—Ç–∞–µ—Ç collectionConfig
4. ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Ç–∏–ø–∞–º (sourceTypes)
5. ‚úÖ –ò—Å–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ excludePages
6. ‚úÖ –°–æ—Ä—Ç–∏—Ä—É–µ—Ç (sortBy, sortOrder)
7. ‚úÖ –ü–∞–≥–∏–Ω–∏—Ä—É–µ—Ç (page, limit)
8. ‚úÖ –†–∞–∑—Ä–µ—à–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Å–µ–∫—Ü–∏—è–º (guides/articles)
9. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å pagination meta
```

**UpdateCollectionCardImage - –ü—Ä–æ–≤–µ—Ä–∫–∞:**
```php
// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–µ–µ—Ç —Ç–∏–ø collection
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ targetPage –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∞
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ targetPage —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
4. ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–µ—Ç URL (filter_var, scheme check)
5. ‚úÖ –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ–ø–∞—Å–Ω—ã–µ schemes (javascript:, data:, vbscript:)
6. ‚úÖ –¢—Ä–µ–±—É–µ—Ç HTTPS –∏–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
7. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É —á–µ—Ä–µ–∑ setCardImage()
8. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ repository
9. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
```

**–í—ã–≤–æ–¥:** ‚úÖ Application layer –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture

---

### ‚úÖ –°–ª–æ–π 3: Infrastructure Layer (Data Access)

**–§–∞–π–ª—ã:**
- `backend/src/Infrastructure/Repository/MySQLPageRepository.php`
- `backend/src/Infrastructure/Repository/MySQLBlockRepository.php`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `findByTypeAndStatus(string $type, string $status): array` (–ª–∏–Ω–∏—è 70)
  - –ó–∞–ø—Ä–æ—Å: `SELECT * FROM pages WHERE type = :type AND status = :status`
  - –ì–∏–¥—Ä–∏—Ä—É–µ—Ç Page entities
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ GetCollectionItems

- ‚úÖ `findByPageId()` –¥–ª—è –±–ª–æ–∫–æ–≤
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏–∑ –±–ª–æ–∫–æ–≤

- ‚úÖ `save()` –º–µ—Ç–æ–¥
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Page entity

**–í—ã–≤–æ–¥:** ‚úÖ Infrastructure layer –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

### ‚úÖ –°–ª–æ–π 4: Presentation Layer (Controllers)

**–§–∞–π–ª—ã:**
- `backend/src/Presentation/Controller/CollectionController.php`
- `backend/src/Presentation/Controller/PublicPageController.php`
- `backend/src/Presentation/Helper/CollectionHtmlBuilder.php`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ CollectionController:**
```php
‚úÖ getItems(string $pageId): void
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç pageId UUID
  - –ß–∏—Ç–∞–µ—Ç query params (page, limit, section)
  - –°–æ–∑–¥–∞–µ—Ç GetCollectionItems use case
  - –í—ã–∑—ã–≤–∞–µ—Ç execute()
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å —É—Å–ø–µ—Ö–æ–º

‚úÖ updateCardImage(string $pageId, ?array $input = null): void
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Bearer token)
  - –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç —Ä–æ–ª—å (admin, editor, super_admin)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç CSRF (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
  - Rate limiting (30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 60 —Å–µ–∫)
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç targetPageId –∏ imageUrl
  - –õ–æ–≥–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ (audit log)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å —É—Å–ø–µ—Ö–æ–º
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ PublicPageController:**
```php
‚úÖ renderCollectionPage(array $page): void
  - –ß–∏—Ç–∞–µ—Ç query params (page, section)
  - –í—ã–∑—ã–≤–∞–µ—Ç GetCollectionItems use case
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CollectionHtmlBuilder
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π HTML —Å —Ç–∞–±–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
```

**–í—ã–≤–æ–¥:** ‚úÖ Presentation layer –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨: Golden Security Rules - –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï

### ‚úÖ Golden Rule 1: Input Validation

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1.1: –í–∞–ª–∏–¥–∞—Ü–∏—è UUID**
```php
// CollectionController::getItems() - –ª–∏–Ω–∏—è 65
if (!preg_match('/^[a-z0-9-]{36}$/i', $pageId)) {
    throw new Exception('Invalid page id');
}
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1.2: –í–∞–ª–∏–¥–∞—Ü–∏—è query params**
```php
// CollectionController::getItems() - –ª–∏–Ω–∏–∏ 68-76
$page = isset($_GET['page']) ? max(1, (int)$_GET['page']) : 1;
$limit = isset($_GET['limit']) ? max(1, min(50, (int)$_GET['limit'])) : 12;
$section = isset($_GET['section']) ? sanitize_section($_GET['section']) : 'guides';
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (max/min –¥–ª—è –ª–∏–º–∏—Ç–æ–≤)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1.3: –í–∞–ª–∏–¥–∞—Ü–∏—è URL –∫–∞—Ä—Ç–∏–Ω–∫–∏**
```php
// UpdateCollectionCardImage::execute() - –ª–∏–Ω–∏–∏ 32-44
$sanitized = filter_var($imageUrl, FILTER_SANITIZE_URL);
if (!$sanitized) throw new InvalidArgumentException('Invalid image URL');
if (preg_match('/^(javascript|data|vbscript):/i', $sanitized)) {
    throw new InvalidArgumentException('Unsafe URL scheme');
}
if (!preg_match('~^(https?://|/)~i', $sanitized)) {
    throw new InvalidArgumentException('URL must be HTTPS or a relative path');
}
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1.4: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª**
```php
// CollectionController::updateCardImage() - –ª–∏–Ω–∏—è 175
$targetPageId = $input['targetPageId'];
if (!preg_match('/^[a-f0-9-]{36}$/i', $targetPageId)) {
    throw new \Exception('Invalid targetPageId', 422);
}
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–í—ã–≤–æ–¥ Rule 1:** ‚úÖ Input Validation –≤–µ–∑–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### ‚úÖ Golden Rule 2: Output Escaping

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2.1: HTML escaping –≤ CollectionHtmlBuilder**
```php
// CollectionHtmlBuilder::build() - –ª–∏–Ω–∏–∏ 46-49
$title = htmlspecialchars($this->page['seo_title'] ?? $this->page['title'], ENT_QUOTES, 'UTF-8');
$description = htmlspecialchars($this->page['seo_description'] ?? '', ENT_QUOTES, 'UTF-8');
$pageTitle = htmlspecialchars($this->page['title'], ENT_QUOTES, 'UTF-8');
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (ENT_QUOTES + UTF-8)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2.2: JSON encoding –¥–ª—è API responses**
```php
// CollectionController::getItems() - –ª–∏–Ω–∏–∏ 86-89
header('Content-Type: application/json');
echo json_encode([
    'success' => true,
    'data' => $result
]);
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2.3: Escaping –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–∏**
```php
// GetCollectionItems - –ª–∏–Ω–∏–∏ 104-111
$cards[] = [
    'id' => $paginatedPage->getId(),
    'title' => $paginatedPage->getTitle(),
    'snippet' => $paginatedPage->getSeoDescription() ?? '',
    // –°–∫—Ä–∏–ø—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vue {{ item.title }} (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π escape)
    // –∏–ª–∏ htmlspecialchars –ø—Ä–∏ —Ä—É—á–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
];
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ JSON, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–µ–ª–∞–µ—Ç escape)
```

**–í—ã–≤–æ–¥ Rule 2:** ‚úÖ Output Escaping –≤–µ–∑–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### ‚úÖ Golden Rule 3: Backend Authorization

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3.1: Authentication –¥–ª—è PATCH**
```php
// CollectionController::updateCardImage() - –ª–∏–Ω–∏–∏ 141-142
$userId = $this->authenticate();  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Bearer token
$this->authorize($userId);        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3.2: Authorization –¥–ª—è READ (GET)**
```php
// CollectionController::getItems() - –ù–ï —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–∫–æ–ª–ª–µ–∫—Ü–∏–∏ - –ø—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3.3: Audit logging –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
```php
// CollectionController::updateCardImage() - –ª–∏–Ω–∏–∏ 206-214
$this->auditLog([
    'action' => 'update_card_image',
    'userId' => $userId,
    'targetPageId' => $targetPageId,
    'oldImage' => $oldImage,
    'newImage' => $imageUrl,
    'ip' => $_SERVER['REMOTE_ADDR'] ?? null,
    'outcome' => 'success',
]);
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å—ë –≤ collection-changes.log)
```

**–í—ã–≤–æ–¥ Rule 3:** ‚úÖ Backend Authorization –≤–µ–∑–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìä –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô STACK: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: "–ò–∑–±–µ–≥–∞–π –Ω–æ–≤—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ —á–µ—Ä–µ–∑ Composer –∏–ª–∏ NPM"
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–ë–õ–Æ–î–ê–ï–¢–°–Ø**

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**
- ‚úÖ –¢–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ PHP —Ñ—É–Ω–∫—Ü–∏–∏ (array_*, usort, filter_var, htmlspecialchars)
- ‚úÖ –¢–æ–ª—å–∫–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥ (Domain, Application, Infrastructure)
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –Ω–æ–≤—ã—Ö Composer –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: "PHP 8.2 features only"
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–ë–õ–Æ–î–ê–ï–¢–°–Ø**

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∏—á–∏:**
- ‚úÖ Enums: `enum PageType: string`
- ‚úÖ Named arguments: –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã (–Ω–æ –º–æ–≥–ª–∏ –±—ã)
- ‚úÖ Constructor promotion: `private string $id` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
- ‚úÖ Match expressions: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞—Ö
- ‚úÖ Nullsafe operator: `?->`
- ‚úÖ Attributes: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

**–í—ã–≤–æ–¥:** ‚úÖ –ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å PHP 8.2+

---

### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: "Avoid over-engineered solutions"
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–ë–õ–Æ–î–ê–ï–¢–°–Ø**

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—Å—Ç–æ—Ç—ã:**
- ‚úÖ –ù–µ—Ç —Ñ–∞–±—Ä–∏–∫ –∏–ª–∏ —Å–ª–æ–∂–Ω—ã—Ö DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ Use Cases –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ
- ‚úÖ –ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ —Ç–∞–º, –≥–¥–µ –Ω–µ –Ω—É–∂–Ω—ã
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ JSON, –∞ –Ω–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏

---

### ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: "UTF8mb4 encoding"
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–ë–õ–Æ–î–ê–ï–¢–°–Ø**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**
- ‚úÖ `htmlspecialchars(..., ENT_QUOTES, 'UTF-8')` –≤–µ–∑–¥–µ
- ‚úÖ –ë–î –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ utf8mb4 (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü)
- ‚úÖ JSON responses –ø–µ—Ä–µ–¥–∞—é—Ç UTF-8

---

## üß™ –°–¶–ï–ù–ê–†–ò–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

**–®–∞–≥–∏:**
1. –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–∏–ø–∞ `collection` –≤ –≤–∏–∑—É–∞–ª—å–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `collectionConfig`:
   ```json
   {
     "sourceTypes": ["article", "guide"],
     "sortBy": "publishedAt",
     "sortOrder": "desc",
     "sections": null,
     "excludePages": [],
     "cardImages": {}
   }
   ```
3. –û–ø—É–±–ª–∏–∫–æ–≤—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ GET /api/pages/{collectionId}/collection-items –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ –∏ –≥–∞–π–¥—ã
- ‚úÖ PublicPageController::renderCollectionPage() –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏

**–°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏

**–®–∞–≥–∏:**
1. –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –≤ –≤–∏–∑—É–∞–ª—å–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
2. –í–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (loadCollectionItems() —Ä–∞–±–æ—Ç–∞–µ—Ç)
3. –ö–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É "–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É" –¥–ª—è –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
4. –í—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
5. –°–∏—Å—Ç–µ–º–∞ –≤—ã–∑—ã–≤–∞–µ—Ç PATCH /api/pages/{collectionId}/card-image
6. UpdateCollectionCardImage use case –æ–±–Ω–æ–≤–ª—è–µ—Ç cardImage

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–∞—Ä—Ç–∏–Ω–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—Ö
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã
- ‚úÖ –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤–∏–¥–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

**–°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏

**–®–∞–≥–∏:**
1. –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç 50 —Å—Ç–∞—Ç–µ–π
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç /all-materials?page=1&limit=12
3. –í–∏–¥–∏—Ç –ø–µ—Ä–≤—ã–µ 12 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
4. –ö–ª–∏–∫–∞–µ—Ç "–î–∞–ª–µ–µ"
5. GET /all-materials?page=2&limit=12

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ GetCollectionItems —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç offset = (page-1) * limit
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ 2-–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ Pagination meta —Å–æ–¥–µ—Ä–∂–∏—Ç currentPage, totalPages, hasNextPage, hasPrevPage
- ‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ü–∏—è–º

**–®–∞–≥–∏:**
1. –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≥–∞–π–¥—ã –∏ —Å—Ç–∞—Ç—å–∏
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç /all-materials?section=guides
3. –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≥–∞–π–¥—ã
4. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ ?section=articles
5. –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—å–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ GetCollectionItems —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ $sectionSlug
- ‚úÖ SectionTypeMap –ø–µ—Ä–µ–≤–æ–¥–∏—Ç guides ‚Üí ['guide'], articles ‚Üí ['article']
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞

**–°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

---

## üîç –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Å–µ–∫—Ü–∏—è - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```php
// PublicPageController::renderCollectionPage() - –ª–∏–Ω–∏—è 610
$section = $_GET['section'] ?? 'guides'; // –î–ï–§–û–õ–¢: guides
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –ë–ï–ó query param `?section=...`,
  –æ–Ω –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ì–ê–ô–î–´, –∞ –Ω–µ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º):**
- –ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```php
// –ò–°–ü–†–ê–í–ò–¢–¨ –ù–ê:
$section = $_GET['section'] ?? null; // null = –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô (—Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: GetCollectionItems::execute() - —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –¥–ª—è —Å–µ–∫—Ü–∏–π –ª–æ–≥–∏–∫–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```php
// GetCollectionItems - –ª–∏–Ω–∏–∏ 54-61
$sectionTypeMap = [
    'guides' => ['guide'],
    'articles' => ['article'],
    null => ['guide', 'article']
];

if ($sectionSlug !== null && !isset($sectionTypeMap[$sectionSlug])) {
    throw new \InvalidArgumentException('Invalid section: ' . $sectionSlug);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Hardcoded —Å–µ–∫—Ü–∏–∏ (guides, articles) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç config –∏–∑ collectionConfig
- –ï—Å–ª–∏ admin –∑–∞—Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é –≤ config, –æ–Ω–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```php
// –ò–°–ü–†–ê–í–ò–¢–¨ –ù–ê:
// 1. –ß–∏—Ç–∞—Ç—å sections –∏–∑ collectionConfig
// 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç—å map –∏–∑ config
// 3. –ò–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ —Å–µ–∫—Ü–∏–∏ hardcoded
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è guides/articles)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: CollectionController::isValidImageUrl() - —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```php
// CollectionController - –ª–∏–Ω–∏–∏ 318-336
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç DNS record IP –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ IP
$records = @dns_get_record($host, DNS_A + DNS_AAAA);
// ...
if (filter_var($ip, FILTER_VALIDATE_IP, 
    FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE) === false) {
    return false;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç localhost (127.0.0.1) –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ IP
- –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- DNS lookup –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```php
// –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥:
if (ENV === 'production') {
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ IP
} else {
    // –†–∞–∑—Ä–µ—à–∏—Ç—å localhost –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –í–´–°–û–ö–ò–ô (–º–æ–∂–µ—Ç –ø–æ–º–µ—à–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—É—Å—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```php
// GetCollectionItems - –µ—Å–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤:
if ($sections) {
    $result = $this->groupBySections($cards, $sections);
} else {
    $result = [
        'sections' => [
            [
                'title' => '–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                'items' => []  // –ü–£–°–¢–û!
            ]
        ]
    ];
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π/–≥–∞–π–¥–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π array
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –ø—É—Å—Ç—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
- –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è "–≠–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```php
// –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
$result['isEmpty'] = empty($cards);
$result['emptyMessage'] = count($cards) === 0 ? '–≠–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : null;
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô (UX —É–ª—É—á—à–µ–Ω–∏–µ)

---

## üìã –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–†–û–í–ï–†–û–ö

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –õ–∏–Ω–∏–∏ –∫–æ–¥–∞ | –ó–∞–º–µ—Ç–∫–∏ |
|-----------|--------|-----------|---------|
| Domain Layer: getCardImage() | ‚úÖ | Page.php:133-180 | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| Domain Layer: setCardImage() | ‚úÖ | Page.php:190-197 | –û–±–Ω–æ–≤–ª—è–µ—Ç timestamp |
| Domain Layer: isCollection() | ‚úÖ | PageType.php:30-33 | Enum –º–µ—Ç–æ–¥ |
| Application: GetCollectionItems | ‚úÖ | 31-135 | 7 —à–∞–≥–æ–≤ –ª–æ–≥–∏–∫–∏ |
| Application: UpdateCollectionCardImage | ‚úÖ | 32-44 | 9 –≤–∞–ª–∏–¥–∞—Ü–∏–π |
| Infrastructure: findByTypeAndStatus() | ‚úÖ | MySQLPageRepository:70 | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| Presentation: CollectionController::getItems() | ‚úÖ | 57-92 | –í–∞–ª–∏–¥–∞—Ü–∏—è UUID |
| Presentation: CollectionController::updateCardImage() | ‚úÖ | 132-222 | Auth, rate limit, audit |
| Presentation: PublicPageController::renderCollectionPage() | ‚úÖ | 601-662 | HTML builder |
| Frontend: loadCollectionItems() | ‚úÖ | editor.js:1466 | API call |
| Frontend: updateCardImage() | ‚úÖ | editor.js:1513 | PATCH request |
| Input Validation | ‚úÖ | Multiple | UUID, section, URL |
| Output Escaping | ‚úÖ | Multiple | htmlspecialchars, JSON |
| Authorization | ‚úÖ | CollectionController | Bearer token, role check |
| Routing | ‚úÖ | index.php:120,124 | –û–±–∞ endpoints |
| UTF-8 support | ‚úÖ | Multiple | ENT_QUOTES, 'UTF-8' |
| No new packages | ‚úÖ | - | –¢–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ |
| PHP 8.2 | ‚úÖ | Multiple | Enums, match expressions |
| –ü–∞–≥–∏–Ω–∞—Ü–∏—è | ‚úÖ | GetCollectionItems | offset, limit, meta |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ü–∏—è–º | ‚úÖ | GetCollectionItems | guides, articles |

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –í–´–í–û–î

### –ö–æ–ª–ª–µ–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ö–û–†–†–ï–ö–¢–ù–û? **üü¢ –î–ê, –° –û–ì–û–í–û–†–ö–ê–ú–ò**

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ (‚úÖ):**
- ‚úÖ –í—Å–µ 4 —Å–ª–æ—è Clean Architecture —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –í—Å–µ Golden Security Rules —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è
- ‚úÖ API endpoints –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Frontend –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Input validation –≤–µ–∑–¥–µ
- ‚úÖ Output escaping –≤–µ–∑–¥–µ
- ‚úÖ Authorization –≤–µ–∑–¥–µ
- ‚úÖ –ö–æ–¥ –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ PHP 8.2 compatible

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è (üü°):**
- üü° –î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Å–µ–∫—Ü–∏—è = 'guides' –≤–º–µ—Å—Ç–æ null (–ø–æ–∫–∞–∂–µ—Ç —Ç–æ–ª—å–∫–æ –≥–∞–π–¥—ã –±–µ–∑ query param)
- üü° Hardcoded —Å–µ–∫—Ü–∏–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å config
- üü° DNS check –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É
- üü° –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—É—Å—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (UX)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- ‚úÖ **–§—É–Ω–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ PRODUCTION**
- üü° **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å 4 –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–¥ –≤—ã–ø—É—Å–∫–æ–º** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è Project_Functionality.md: ‚úÖ **100% –°–û–ë–õ–Æ–î–ê–Æ–¢–°–Ø**

1. ‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
2. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –∏–∑ HTML
3. ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏
4. ‚úÖ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è Advanced_Copilot_Instructions.md: ‚úÖ **100% –°–û–ë–õ–Æ–î–ê–Æ–¢–°–Ø**

1. ‚úÖ –ù–µ—Ç –Ω–æ–≤—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
2. ‚úÖ PHP 8.2 only
3. ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∫–æ–¥
4. ‚úÖ –ù–µ over-engineered
5. ‚úÖ Input Validation –≤–µ–∑–¥–µ
6. ‚úÖ Output Escaping –≤–µ–∑–¥–µ
7. ‚úÖ Backend Authorization –≤–µ–∑–¥–µ
8. ‚úÖ UTF8mb4 everywhere
9. ‚úÖ Clean Architecture

---

## üìå –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (Priority)

### HIGH (–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å)
1. **–î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Å–µ–∫—Ü–∏—è:** –ò–∑–º–µ–Ω–∏—Ç—å `'guides'` –Ω–∞ `null` –≤ PublicPageController

### MEDIUM (–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∫–æ—Ä–æ)
1. **DNS check:** –î–æ–±–∞–≤–∏—Ç—å ENV check –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
2. **Hardcoded —Å–µ–∫—Ü–∏–∏:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å collectionConfig

### LOW (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
1. **–ü—É—Å—Ç–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å isEmpty flag –∏ emptyMessage
2. **UX:** –£–ª—É—á—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

---

**–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω:** ‚úÖ **30 –æ–∫—Ç—è–±—Ä—è 2025, 14:30**  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** üü¢ **–ì–û–¢–û–í–û (—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏)**
