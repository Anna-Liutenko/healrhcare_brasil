# Quill Editor Fix - Commit Summary

## Проблемы
1. ❌ При сохранении статьи в Quill размер и выравнивание картинок не сохранялись
2. ❌ При повторном открытии редактора стили изображений были сброшены
3. ❌ Скачанный HTML показывал "битые" изображения
4. ❌ Backend оборачивал article-контент в дополнительные `<p>` теги
5. ❌ sync-to-xampp.ps1 не работал на PowerShell 5.1

## Решения

### 1. Добавлены Quill Style Attributors
**Файл:** `frontend/editor.js`
- FloatAttributor для `float: left|right`
- WidthAttributor для `width`
- MarginAttributor для `margin`
- TextAlignAttributor для `text-align`

**Результат:** Inline-стили теперь сохраняются в Quill дельте и переживают reload

### 2. Переписана setupImageDragAndDrop на Quill API
**Файл:** `frontend/editor.js`
- Заменено прямое манипулирование DOM на `quillInstance.formatText()`
- Стили теперь применяются через Quill и сохраняются в контенте

**Результат:** Drag-n-drop теперь корректно работает с сохранением стилей

### 3. Расширены CSS правила
**Файлы:** `frontend/editor-ui.css`, `frontend/styles.css`
- Добавлены правила для `.ql-editor img[style*="float"]` в редакторе
- Добавлены правила для `.article-content img[style*="float"]` в превью/публике

**Результат:** Float и margin отображаются корректно в UI и на публичной странице

### 4. Исправлена renderTextBlock для article-контента
**Файл:** `backend/src/Application/UseCase/RenderPageHtml.php`
- Для `containerStyle === 'article'` HTML выводится как есть (без `<p>` обёртки)
- Для обычных text-block'ов остаётся `<p>` обёртка

**Результат:** Структура Quill-разметки сохраняется при публикации

### 5. Улучшена exportHTML для абсолютных URL
**Файл:** `frontend/editor.js`
- Добавлено преобразование `/uploads/...` в `http(s)://...`
- Изображения теперь видны при открытии экспортированного HTML локально

**Результат:** Скачанный HTML открывается с видимыми изображениями

### 6. Исправлена совместимость sync-to-xampp.ps1
**Файл:** `sync-to-xampp.ps1`
- Заменен null-coalescing оператор `?.` на совместимый код
- Теперь работает на PowerShell 5.1 (Windows PowerShell)

**Результат:** Скрипт синхронизации работает на всех версиях Windows

## Тестирование
- ✅ Создать страницу в Quill
- ✅ Добавить изображение, установить размер и выравнивание
- ✅ Сохранить и перезагрузить редактор → стили сохранены
- ✅ Проверить превью → выравнивание видно
- ✅ Опубликовать → выравнивание видно на публичной странице
- ✅ Экспортировать HTML → изображения видны локально

## Соответствие стандартам
✅ Следует правилам copilot-instructions.md  
✅ Следует требованиям Project_Functionality.md  
✅ Использует ванильный JavaScript (Vue 3)  
✅ Нет новых зависимостей  
✅ Сохранена санитизация HTML  

---
**Статус:** Готово к merge в main
