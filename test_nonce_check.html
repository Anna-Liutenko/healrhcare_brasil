<!DOCTYPE html>
<html>
<head>
    <title>Проверка куки бутона</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
<h1>Проверка работы куки бутона на публичной странице</h1>

<h2>1. Проверка HTML</h2>
<button onclick="checkHTML()">Загрузить HTML</button>
<div id="result"></div>

<script>
async function checkHTML() {
    const result = document.getElementById('result');
    
    try {
        const response = await fetch('http://localhost/healthcare-cms-backend/public/page/glavnaya-stranitsa');
        const html = await response.text();
        
        // Check for nonce in script tags
        const scriptMatches = html.match(/<script[^>]*nonce="[^"]*"[^>]*>/g);
        const noNonceScripts = html.match(/<script(?![^>]*nonce)[^>]*>/g);
        
        // Check for acceptCookies function
        const hasAcceptCookies = html.includes('acceptCookies');
        
        // Check for cookieBanner div
        const hasCookieBanner = html.includes('cookieBanner');
        
        result.innerHTML = `
            <h3>Результаты:</h3>
            <p>✓ Script tags с nonce: ${scriptMatches ? scriptMatches.length : 0}</p>
            <p>✗ Script tags БЕЗ nonce: ${noNonceScripts ? noNonceScripts.length : 0}</p>
            <p>${hasAcceptCookies ? '✓' : '✗'} Функция acceptCookies присутствует</p>
            <p>${hasCookieBanner ? '✓' : '✗'} Элемент #cookieBanner присутствует</p>
            
            <h4>Первый script tag:</h4>
            <pre>${html.match(/<script[^>]*>/)[0]}</pre>
            
            <h4>Последний script tag:</h4>
            <pre>${html.match(/<\/script>/)[0]}</pre>
        `;
    } catch(e) {
        result.innerHTML = `<p style="color:red">Ошибка: ${e.message}</p>`;
    }
}
</script>
</body>
</html>
